var _____WB$wombat$assign$function_____ = function(name) {return (self._wb_wombat && self._wb_wombat.local_init && self._wb_wombat.local_init(name)) || self[name]; };
if (!self.__WB_pmw) { self.__WB_pmw = function(obj) { this.__WB_source = obj; return this; } }
{
  let window = _____WB$wombat$assign$function_____("window");
  let self = _____WB$wombat$assign$function_____("self");
  let document = _____WB$wombat$assign$function_____("document");
  let location = _____WB$wombat$assign$function_____("location");
  let top = _____WB$wombat$assign$function_____("top");
  let parent = _____WB$wombat$assign$function_____("parent");
  let frames = _____WB$wombat$assign$function_____("frames");
  let opener = _____WB$wombat$assign$function_____("opener");

_.Module.define({path:"encourage-payment/widget/umoney_query",sub:{url:{queryCredit:"/tbapp/umoney/queryUserInfo",queryQualification:"/tbapp/umoney/queryQualification"},query_umoney_cls:".j-query-umoney",umoneyInfoStatus:{s1:"\u672a\u7533\u8bf7",s2:"\u5ba1\u6838\u4e2d",s3:"\u6b63\u5e38",s4:"\u903e\u671f",s5:"\u51bb\u7ed3",s6:"\u5931\u8d25"},initial:function(){var e=this;e.$element=$(".tdou-umoney-query")},showUmoney:function(e){var n=this,t=$.tb.format('<div class="tdou-umoney-query">          <span class="umoney-user">              #{displayText}:              <a class="j-query-umoney " href="javascript:void(0);"                 title="\u67e5\u770b\u6709\u94b1\u989d\u5ea6"                 locate="userinfo#\u767e\u5ea6\u6709\u94b1">                  \u67e5\u770b              </a>          </span>          <span class="umoney-placeholder">              <a target="_blank" href="/f?ie=utf-8&kw=\u767e\u5ea6\u6709\u94b1\u6d88\u8d39\u91d1\u878d"                 locate="userinfo#\u767e\u5ea6\u6709\u94b1">                  \u767e\u5ea6\u6709\u94b1\u9001T\u8c46              </a>          </span>  </div>',{displayText:e||"\u767e\u5ea6\u6709\u94b1\u989d\u5ea6"});return n.getUmoneyDom(t)},showUmoneyOnGotTdou:function(){var e=this,n='<div class="tdou-umoney-query umoney-query-get-tdou">      <span class="umoney-placeholder">\u63d0\u9192\uff1a\u60a8\u5728 pc\u53ca\u5b89\u5353\u4e0a\u83b7\u53d6\u7684T\u8c46\u4e0e\u5728ios\u4e0a\u83b7\u53d6\u7684T\u8c46\u4e0d\u901a\u7528\u3002</span>  </div>',t=e.getUmoneyDom(n);return t},showUmoneyMember:function(){var e=this,n='<div class="tdou-umoney-query tshow-tdou-umoney-query">      <a  target="_blank" href="/f?ie=utf-8&kw=\u767e\u5ea6\u6709\u94b1\u6d88\u8d39\u91d1\u878d" locate="tshow-bar#\u767e\u5ea6\u6709\u94b1">          <span class="umoney-logo"></span>\u4f7f\u7528\u767e\u5ea6\u6709\u94b1\u8d2d\u4e70\u8d34\u5427\u4f1a\u5458\u4f18\u60e0          <span class="vip-red vip-discount">5%</span>      </a>  </div>';return e.$element=$(n),e.$element},getUmoneyDom:function(e){var n=this;return this.$element=$(e),n.isUmoneyUser(),n.$element},bindEvents:function(){var e=this;e.$element.on("click",e.query_umoney_cls,function(){e.queryUmoneyCredit()})},queryUmoneyCredit:function(){var e=this;e._queryUmoneyCredit&&e._queryUmoneyCredit.abort(),e._queryUmoneyCredit=$.ajax({type:"GET",url:e.url.queryCredit,data:{},cache:!1,dataType:"json"}).success(function(n){if(e._queryUmoneyCredit=null,0==n.no){var t=n.data&&n.data.data;e.showCredit(t)}})},isUmoneyUser:function(){var e=this;e._isUmoneyUser&&e._isUmoneyUser.abort(),e._isUmoneyUser=$.ajax({type:"GET",url:e.url.queryCredit,data:{},cache:!1,dataType:"json"}).success(function(n){if(e._isUmoneyUser=null,0==n.no){var t=n.data&&n.data.data.status;"1"!=t&&(e.$element.find(".umoney-placeholder").end().find(".umoney-user").show(),e.bindEvents())}else e.$element.find(".umoney-user").hide().end().find(".umoney-placeholder").show()})},showCredit:function(e){if(e){var n=this,t="";if(3===e.status){var o=e.credit||0;t=o+"\u5143 "}else t=n.umoneyInfoStatus["s"+e.status];var s=t+",\u70b9\u51fb\u5237\u65b0";n.$element.find(n.query_umoney_cls).html(t).addClass("umoney-credit").tbattr("title",s)}},track:function(e){$.stats.track(e,"umoney-query","","click")}}});_.Module.define({path:"encourage-payment/widget/tdou_view_check",requires:["encourage-payment/widget/tdou_builder","encourage-payment/widget/tdou_data","encourage-payment/widget/tdou_view_util"],sub:{initial:function(){this.builder=this.requireInstance("encourage-payment/widget/tdou_builder"),this.dataProxy=this.requireInstance("encourage-payment/widget/tdou_data"),this.viewUtil=this.requireInstance("encourage-payment/widget/tdou_view_util")},showTdouCheckView:function(e,i,t){var n=this;n._wrap=e||$("body");var o=(n._wrap.height()-208)/2+"px",c=(n._wrap.width()-520)/2+"px",d={top:o,left:c},u=n._wrap.find(".j_tdou_get_icon_check");if(0==u.length){var a=this.builder.builderTdouCheck();u=$(a),n._wrap.prepend(u),n._bindEvents(u,i,t)}n.viewUtil.setMask(e),u.css(d),u.show()},hideTdouCheckView:function(){var e=this._wrap.find(".j_tdou_get_icon_check");e.hide(),this.viewUtil.removeMask()},_bindEvents:function(e,i,t){var n=this;e&&e.on("click",".j_header_close",function(){n.hideTdouCheckView()}).on("click",".j_check_btn",function(){n.hideTdouCheckView(),"function"==typeof i&&n._onCheckTdou(i,t)}).on("click",".j_btn_redo_check",function(){n._onRedoBuyIcon()})},_onCheckTdou:function(e,i){"function"==typeof e&&"object"==typeof i&&e.call(i)},_onRedoBuyIcon:function(){this.hideTdouCheckView()}}});_.Module.define({path:"encourage-payment/widget/tdou_counter",sub:{onValueChange:[],initial:function(){},builderUI:function(t){var a=['<div id="tdou_counter_#{id}" class="tdou_calc_count j_tdou_calc_count">','    <button class="tdou_calc_op tdou_calc_minus j_tdou_calc_minus">-</button>','    <input class="tdou_calc_input j_tdou_calc_input" type="text" value="1"/>','    <button  class="tdou_calc_op tdou_calc_add j_tdou_calc_add">+</button>',"</div>"].join(""),n=$.tb.format(a,{id:t});return n},bindEvents:function(t){var a=this;if(t){var n=999999,c=t.find(".j_tdou_calc_input"),e=t[0].id.replace("tdou_counter_","");t.delegate(".j_tdou_calc_minus","click",function(){var t=parseInt(c.val())||1;t=Math.max(1,t-1),t=Math.min(n,t),c.val(t),a.triggerValChange(t,e)}).delegate(".j_tdou_calc_add","click",function(){var t=parseInt(c.val())||1;t++,t=Math.min(n,t),c.val(t),a.triggerValChange(t,e)}).delegate(".j_tdou_calc_input","input propertychange",function(){var t=/^[1-9]\d*$/,o=c.val();(o&&!t.test(o)||t.test(o)&&o>999)&&(o=o.replace(/\D/g,"").replace(/^0(\d*)$/,"$1"),o=Math.min(n,o),c.val(o),a.triggerValChange(o,e))});var o=function(){var t=c.val()&&parseInt(c.val())>0&&parseInt(c.val())||1;t=Math.min(n,t),c.val(t),a.triggerValChange(t,e)};c.on("blur",function(){o()}).on("keydown",function(t){13==t.keyCode&&o()})}},triggerValChange:function(t,a){for(var n=0;n<this.onValueChange.length;n++){var c=this.onValueChange[n];c.action&&"function"==typeof c.action&&c.context&&c.action.call(c.context,t,a)}}}});_.Module.define({path:"encourage-payment/widget/tdou_view",requires:["encourage-payment/widget/tdou_builder","encourage-payment/widget/tdou_data","encourage-payment/widget/tdou_counter","encourage-payment/widget/tdou_view_util","encourage-payment/widget/tdou_view_check","encourage-payment/widget/TdouOpenType","encourage-payment/widget/qianbao_purchase_tdou","encourage-payment/widget/umoney_query"],sub:{PayMemberUrl:"/tbmall/getMyPayType",CASHIER:1,QIANBAO:2,initial:function(e){e=$.extend({},e);e.scores,e.level;this.builder=this.requireInstance("encourage-payment/widget/tdou_builder"),this.dataProxy=this.requireInstance("encourage-payment/widget/tdou_data",{scores:e.scores,level:e.level}),this.counter=this.requireInstance("encourage-payment/widget/tdou_counter"),this.viewUtil=this.requireInstance("encourage-payment/widget/tdou_view_util"),this.checkTdou=this.requireInstance("encourage-payment/widget/tdou_view_check"),this.openTypeList=this.requireInstance("encourage-payment/widget/TdouOpenType",{type:"tdou"})},createMain:function(e,t,n,o){var a=this;a.consumption_path=e,a.desc=t,a.current_need_tdou=n,a.is_direct_cashier=o;var i=$.tb.location.getHref();a.openType=a.openTypeList.getOpenType(e),a.dataProxy.getIconInfo(a.builderMainUI,a,i)},builderMainUI:function(e){var t=this;if(e&&0===e.no){var n=e.data,o=t.builder.builderGetTdouMain(n);t.renderMain(o),t.bindMainUIEvents(),t.dataProxy.isLogin()||$(".j_tdou_body_title").hide(),t.setDefaultSlected(),t.addUmoney()}else e&&11e4===e.no&&this.viewUtil.OpenLoginDialog()},renderMain:function(e){var t="tdou_pay_icon_dialog",n={modal:!0,showTitle:!1,fixed:!0,width:620,height:545,holderClassName:t,draggable:!0};n.html=e,this._dialog=new $.dialog(n),this._dialog.element[0].id=t,this._dialog.show()},setDefaultSlected:function(){$(".j_tdou_base_list li:eq(1)").trigger("click")},bindMainUIEvents:function(){var e=this;e.bindCounterEvent(),$(".j_header_close").on("click",function(){e.trigger("after_buy_icon"),e.closeMain()}),$(".j_tdou_give_btn_big").on("click",function(){e.trigger("after_buy_icon"),e.closeMain()}),$(".j_tdou_get_item").on("click",function(){var t=$(this);e.selectIconItem(t)}).on("mouseenter",function(){var e=$(this);e.addClass("tdou_item_hover")}).on("mouseleave",function(){var e=$(this);e.removeClass("tdou_item_hover")}),$(".j_tdou_buy_btn_big").on("click",function(){var t=$(".goods_wrap_selected");if(0!=t.length){var n=$(".j_tdou_calc_input").val(),o=t[0].id;e.wrap=$("#tdou_pay_icon_dialog");var a=$.tb.location.getHref();e.payChannel=2,e._openCtrl("dialog"),e.payType=e.QIANBAO,e.viewUtil.displayLoading(e.wrap),e.dataProxy.payIcon(o,n,e.buyIcon,e,a,e.consumption_path,e.payChannel)}}),this.buildStatsEvent()},buildStatsEvent:function(){$(".good_price_joinvip").find("a").on("click",function(){$.stats.track("T\u8c46\u94b1\u5305","\u4f1a\u5458\u5065\u5eb7\u7edf\u8ba1","","click",{obj_name:"\u83b7\u53d6T\u8c46\u70b9\u51fb\u8d34\u5427\u8d85\u7ea7\u4f1a\u5458"})})},_openCtrl:function(e){var t=this,n=t.openType;switch(e="win"===e||"dialog"===e?e:n){case"win":t.openNewWindow();break;case"dialog":}},openNewWindow:function(){this.win=window.open("")},bindCounterEvent:function(){var e=this;$(".tdou_calc_count_wrap").each(function(){e.counter.bindEvents($(this).find(".j_tdou_calc_count")),e.counter.onValueChange.push({action:e.onCounterValueChange,context:e})})},closeMain:function(){this._dialog.close(),this.dataProxy.clearCache()},selectIconItem:function(e){if(e){$(".j_tdou_get_item").removeClass("goods_wrap_selected"),e.addClass("goods_wrap_selected");var t=this,n=e.tbattr("id");$(".j_tdou_counter_replace").html(t.counter.builderUI(n));var o=$("#tdou_counter_"+n);t.counter.bindEvents(o),t.counter.onValueChange.push({action:t.onCounterValueChange,context:t}),t.onCounterValueChange(1,n)}},onCounterValueChange:function(e,t){var n=this.dataProxy.getPriceInfo(e,t),o=this.dataProxy.getMemberLevel();$(".j_goods_member_num").html(o>1?n.member_price:n.non_member_price),$(".j_goods_tmall_price_num").html(n.tbmall_price)},buyIcon:function(e){var t=this;if(t.viewUtil.hideLoading(),t.wrap=$("#tdou_pay_icon_dialog"),t.tbs=PageData.tbs,e&&0===e.no)if(t.win)t.checkTdou.showTdouCheckView(t.wrap,t.updateTdou,t),t.win.location.href=e.data;else{t.cashier=t.requireInstance("encourage-payment/widget/qianbao_purchase_tdou");var n=e.data,o=$.extend({product:"tdou",consumption_path:t.consumption_path,goods_cost_tdou:t.current_need_tdou,pay_type:6,pay_channel:t.payChannel},{qianbao_params:n.return_url,iconCount:n.iconCount,iconId:n.iconId}),a={ie:"utf-8",tbs:t.tbs,terminal:"pc",pay_type:6,iconId:n.iconId,pageUrl:n.return_url||"",margin:t.current_need_tdou,goodsCost:t.current_need_tdou,fr:t.consumption_path||0,channel:t.payChannel};t.cashier.showDialog(o,a)}else if(e&&11e4===e.no)t.closeMain(),t.viewUtil.OpenLoginDialog(),t.win&&t.win.close();else if(e&&1990055===e.error_code)if("undefined"==typeof passport||"undefined"==typeof passport.pop.init){var i="undefined"!=typeof Env&&Env.server_time?Env.server_time:(new Date).getTime(),r="https://web.archive.org/web/20201119054109/https://passport";$.JsLoadManager.use([r+".baidu.com/passApi/js/uni_login_wrapper.js?cdnversion="+Math.floor(i/6e4),r+".baidu.com/passApi/js/wrapper.js?cdnversion="+Math.floor(i/6e4)],function(){window.realname=passport.pop.init({type:"accRealName",apiOpt:{product:"tb",staticPage:"//web.archive.org/web/20201119054109/https://tieba.baidu.com/tb/static-common/html/pass/v3Jump.html"},tangram:!0,color:"green"}),window.realname.show()},!0,"utf-8")}else window.realname.show();else this.viewUtil.displayErrorInfo(t.wrap,""),t.win&&t.win.close()},updateTdou:function(){var e=this;e.dataProxy.getTdou(e.onUpdateTdou,e)},onUpdateTdou:function(e){var t=this;if(e&&0===e.no){var n=e.data.Parr_scores,o=$("#tdou_remain_num"),a=n?n.scores_money+n.scores_other:0,i=t.dataProxy.getUserTdou();if(o.val(a),a-i>=1e4){t.wrap=$("#tdou_pay_icon_dialog");var r=t.dataProxy.getUserName();this.viewUtil.dispalySuccessedInfo(t.wrap,r,function(){t.trigger("after_buy_icon",n),t.closeMain()},t)}else this.viewUtil.displayErrorInfo(t.wrap,"",function(){t.trigger("after_buy_icon",n),t.closeMain()},t)}},addUmoney:function(){var e=this;e.umoney=e.requireInstance("encourage-payment/widget/umoney_query");var t=e.umoney.showUmoneyOnGotTdou();e._dialog.element.find(".j_tdou_umoney").append(t)},isQianbaoHitSmallFlow:function(){var e=PageData&&PageData.user&&PageData.user.id;return e?"1157380926"==e||"707573940"==e||"963463500"==e||"1093896819"==e||"1496"==e||"1134652730"==e||"982451133"==e?!0:(e=parseInt(e),e%1===0):!1}}});_.Module.define({path:"encourage-payment/widget/tdou",requires:["encourage-payment/widget/tdou_view","encourage-payment/widget/tdou_view_auto_redirect"],sub:{initial:function(e){e=$.extend({scores:{level:2,limit:8e3,scores_fetch:0,scores_money:534,scores_other:80,scores_total:614,update_time:1432008154},level:{end_time:"1421055636",expired_notify:1,expiring_notify:1,left_num:0,max_free_score:8e3,open_status:null,props_category:105,props_id:2,props_type:0,update_time:null,used_status:1}},e);var t=e.scores,o=e.level;this.view=this.requireInstance("encourage-payment/widget/tdou_view",{scores:t,level:o}),this.autoDirect=this.requireInstance("encourage-payment/widget/tdou_view_auto_redirect")},factory:function(e,t){var o="",i="",r=0;switch(e){case"get_icon":o=t.consumption_path,i=t.desc,r=t.current_need_tdou,this.view.createMain(o,i,r);break;case"auto_direct":var s={consumption_path:t.consumption_path,title:t.desc,need_tdou:t.current_need_tdou,goods_cost_tdou:t.goods_cost_tdou||0,pay_type:t.pay_type,tbs:t.tbs,order_id:t.order_id,is_dialog:t.is_iframe};this.autoDirect.createMain(s);break;case"payment":}}}});_.Module.define({path:"encourage-payment/widget/tcharge_dialog",requires:["encourage-payment/widget/tdou","encourage-payment/widget/tdou_get"],sub:{initial:function(e){var t=this;$.stats.track("all","\u6253\u5f00T\u8c46\u6536\u94f6\u53f0","all","show"),e=$.extend({},e);var a=t.requireInstance("encourage-payment/widget/tdou",[{scores:e.scores,level:e.level}]);e&&e.chargeType&&"platform"==e.chargeType?a.factory("payment",e):(e&&(t.consumption_path=e.consumption_path,t.desc=e.desc,t.current_need_tdou=e.current_need_tdou,t.is_direct_cashier=e.is_direct_cashier),e&&t.is_direct_cashier?a.factory("auto_direct",e):t.requireInstance("encourage-payment/widget/tdou_get",e))}}});_.Module.define({path:"encourage-payment/widget/tdou_view_pay",requires:["encourage-payment/widget/tdou_builder","encourage-payment/widget/tdou_data","encourage-payment/widget/tdou_view_util","encourage-payment/widget/tdou_view_auto_redirect","encourage-payment/widget/tdou_view_operation_bootstrap","encourage-payment/widget/payMember","encourage-payment/widget/tdou_view"],sub:{errors:{110000:"\u7528\u6237\u672a\u767b\u9646",2320007:"\u7cfb\u7edf\u9519\u8bef\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",210009:"\u7cfb\u7edf\u9519\u8bef\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",2270044:"\u8d26\u53f7\u5f02\u5e38\uff0c\u8bf7\u91cd\u65b0\u767b\u9646",2270047:"\u652f\u4ed8\u5931\u8d25\u2014\u8ba2\u5355\u5931\u6548",2270050:"\u8ba2\u5355\u72b6\u6001\u5f02\u5e38",2270049:"\u5546\u54c1\u8fc7\u671f\uff0c\u8bf7\u91cd\u65b0\u8d2d\u4e70",2270015:"\u5546\u54c1\u4e0d\u53ef\u5151\u6362",2270051:"\u7cfb\u7edf\u7ef4\u62a4\u4e2d..."},order_status:{0:"\u652f\u4ed8\u672a\u5b8c\u6210\uff01",1:"\u652f\u4ed8\u6210\u529f\uff0c\u5546\u54c1\u5151\u6362\u4e2d\uff01",2:"\u5151\u6362\u6210\u529f",3:"\u5151\u6362\u5931\u8d25\uff0cT\u8c46\u5df2\u9000\u8fd8",4:"\u5151\u6362\u8d85\u65f6\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458"},tdou_buy_confirm_tag:"tdou_buy_confirm",is_iframe:!0,initial:function(e,t){t=$.extend({},t);var o=t.scores,a=t.level;this.builder=this.requireInstance("encourage-payment/widget/tdou_builder"),this.dataProxy=this.requireInstance("encourage-payment/widget/tdou_data",{scores:o||0,level:a||0}),this.viewUtil=this.requireInstance("encourage-payment/widget/tdou_view_util"),this.message=e,this.autoDirect=this.requireInstance("encourage-payment/widget/tdou_view_auto_redirect")},createMain:function(e){var t=this;t.notShowSucTips=e.notShowSucTips,t.dataProxy.getPayInfo(e,t.onPayInfo,t)},onPayInfo:function(e){if(this.sendMessage("pay_info",e),e&&0===e.no){var t=e.data.goods_info,o=e.data.order_info,a=e.data.user_info;this.pay_info={},this.pay_info.goods_info=t,this.pay_info.order_info=o,this.pay_info.user_info=a,this.createUI(t,o,a)}else this.handleError(e.no)},createUI:function(e,t,o){var a=this,i="",n=o.Parr_props;a.dataProxy.setParrProps(n);var r=a.dataProxy.getMemberLevel(),d=2==r,_=o.Parr_scores,u=0;_&&(u=_.scores_money+_.scores_other);var s=u>=e.tdou_num,c=0;s||(c=e.tdou_num-u);var l=e.free_vip_level;if(s&&(t.cpath.pay_cashier||void 0==t.cpath.pay_cashier))return void a.pay(!1);if(!s&&(t.cpath.gettdou_cashier||void 0==t.cpath.gettdou_cashier))return void a.getTdou(!1);var f=a.confirmCount();return s&&f>0?(f-=1,a.confirmCount(f),void a.pay(!1)):(d&&l?i=a.createUI_memberGetTdou_free(s,e,t,c):d&&!l?i=a.createUI_memberGetTdou(s,e,t,c):!d&&l?i=a.createUI_nonMemberGetGoodsOwnedMember(s,e,t,c):d||l||(i=a.createUI_nonMemberGetTdouOwnedMember(s,e,t,c)),a.renderMain(i),a.initUIData(),void a.bindMainUIEvents())},directToCrasher:function(e,t,o){var a=this,i=o.Parr_props;a.dataProxy.setParrProps(i);var n=o.Parr_scores,r=0;n&&(r=n.scores_money+n.scores_other);var d=r>=e.tdou_num,_=0;d||(_=e.tdou_num-r),d?a.pay(!1):a.getTdou(!1)},initUIData:function(){var e=this,t=e.confirmCount(),o=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_buy_confirm");o.length>0&&(parseInt(t)>0?o.tbattr("checked",!0):o.tbattr("checked",!1))},createUI_nonMemberGetGoodsOwnedMember:function(e,t,o,a){t.tdou_pay_from=o.from;var i=this.builder.buildPayTdouMain_nonMemberGetGoodsOwnedMember(e,t,o,a);return i},createUI_nonMemberGetTdouOwnedMember:function(e,t,o,a){t.tdou_pay_from=o.from;var i=this.builder.buildPayTdouMain_nonMemberGetTdouOwnedMember(e,t,o,a);return i},createUI_memberGetTdou:function(e,t,o,a){t.tdou_pay_from=o.from;var i=this.builder.buildPayTdouMain_memberGetTdou(e,t,o,a);return i},createUI_memberGetTdou_free:function(e,t,o,a){t.tdou_pay_from=o.from;var i=this.builder.buildPayTdouMain_memberGetTdou_freeGoods(e,t,o,a);return i},renderMain:function(e){if(!($(".baidu_tb_tdou_payment_dialog").length>0)){var t={modal:!0,showTitle:!1,fixed:!0,width:610,height:275,holderClassName:"baidu_tb_tdou_payment_dialog",draggable:!0};t.html=e,this._dialog=new $.dialog(t),this._dialog.element[0].id="baidu_tb_tdou_payment_dialog",this._dialog.show(),this.sendMessage("ui:main:create",this._dialog)}},bindMainUIEvents:function(){var e=this,t=e._dialog.element;t.find(".j_tdou_pay_header_close").on("click",function(){e.closeMain(),e.sendMessage("closed","");var t=e.requireInstance("encourage-payment/widget/tdou_view_operation_bootstrap"),o={actionType:"CLOSE_PAYMENT"};t.triggerByScene(o,e.pay_info)}),t.delegate(".j_tb_tdou_pay_btn","click",function(){e.pay()}).delegate(".j_tb_tdou_get_tdou_btn","click",function(){e.getTdou()}).delegate(".j_tdou_enable_member","click",function(){var e=$(".j_baidu_tb_tdou_pay_info_box .j_tb_tdou_get_tdou_btn");$(this).tbattr("checked")?(e.html("\u5f00\u901a\u4f1a\u5458\u5e76\u83b7\u53d6T\u8c46"),e.addClass("tdou_pay_btn_135")):(e.html("\u83b7\u53d6T\u8c46"),e.removeClass("tdou_pay_btn_135"))}).delegate(".j_tdou_buy_confirm","click",function(){e.confirmCount($(this).tbattr("checked")?30:0)}).delegate(".j_tdou_buy_icon","click",function(){e.getIcon()}).delegate(".j_tdou_open_super_member_link","click",function(){e.closeMain();var t=e.requireInstance("encourage-payment/widget/payMember"),o={fr:"tdou_view_pay"};t.showCashier(o)})},pay:function(e){var t=this,o=e;"undefined"==typeof e&&(o=!0);var a={no_ui:o};t.dataProxy.payGoods(t.onPay,t,a)},onPay:function(e,t){var o=this;t&&!t.no_ui?o.wrap=null:(o.wrap=null,o.closeMain());var a=o.dataProxy.getPayInfoCache();if(0===e.no){var i={from:a.order_info.from,goods_name:$.tb.subByte(a.goods_info.goods_name,24,""),order_status:e.data.order_info.status,price:a.goods_info.tdou_num};o.viewUtil.displayPaymentSuccess(o.wrap,i,function(){o.closeMain(),o.sendMessage("paid",e)},o,o.notShowSucTips)}else o.viewUtil.displayPaymentFailed(o.wrap,$.tb.subByte(a.goods_info.goods_name,24,""),function(){o.closeMain(),o.sendMessage("paid",e)},o)},getTdou:function(e){var t=this,o=!1,a=e;"undefined"==typeof e&&(a=!0),a?(o=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_enable_member").tbattr("checked"),this.closeMain()):o=!1;var i=t.dataProxy.getPayInfoCache(),n=i.order_info.cpath,r={consumption_path:i.order_info.scene_id,title:"\u7b2c\u4e09\u65b9\u652f\u4ed8:\u83b7\u53d6T\u8c46",need_tdou:0,third_order_id:i.order_info.order_id,goods_cost_tdou:i.goods_info.tdou_num};o?($.extend(r,{title:"\u7b2c\u4e09\u65b9\u652f\u4ed8:\u5f00\u901a\u8d85\u7ea7\u4f1a\u5458,\u83b7\u53d6T\u8c46",pay_type:7,tbs:i.tbs}),n&&"1"==n.purchase&&$.extend(r,{title:"\u7b2c\u4e09\u65b9\u652f\u4ed8:\u5f00\u901a\u8d85\u7ea7\u4f1a\u5458,\u83b7\u53d6T\u8c46,\u8d2d\u4e70\u5546\u54c1",pay_type:9,tbs:i.tbs})):n&&"1"==n.purchase&&$.extend(r,{title:"\u7b2c\u4e09\u65b9\u652f\u4ed8:\u8d2d\u4e70\u5546\u54c1,\u83b7\u53d6T\u8c46",pay_type:8,third_order_id:i.order_info.order_id,tbs:i.tbs}),t.goCashier(r,a)},goCashier:function(e,t){var o=this,a={consumption_path:e.consumption_path,title:e.desc,need_tdou:e.current_need_tdou,goods_cost_tdou:e.goods_cost_tdou||0,pay_type:e.pay_type||6,tbs:e.tbs,order_id:e.third_order_id,is_dialog:!t,pay_info:o.pay_info};this.autoDirect.display_type="third_app",this.autoDirect.third_order_id=e.third_order_id,this.autoDirect.createMain(a)},getIcon:function(){var e=this;e.closeMain();var t=e.dataProxy.getPayInfoCache();e.view=this.requireInstance("encourage-payment/widget/tdou_view"),e.view.bind("after_buy_icon",function(o,a){var i=t.goods_info,n=t.order_info,r=t.user_info;null!=a&&(r.Parr_scores=a),e.createUI(i,n,r)},e);var o=t.order_info.scene_id,a="\u7b2c\u4e09\u65b9\u8d2d\u4e70icon",i=t.goods_info.tdou_num;e.view.createMain(o,a,i)},closeMain:function(){this._dialog&&this._dialog.close(),this.dialog=null},confirmCount:function(){var e=this,t=arguments[0],o=0,a=new Date,i=a.getFullYear()+""+(a.getMonth()+1)+a.getDate();if("undefined"!=typeof t){o=parseInt(t);var n=i+"#"+o;$.tb.Storage.set(e.tdou_buy_confirm_tag,n)}else{if(t=$.tb.Storage.get(e.tdou_buy_confirm_tag),null==t)return 0;var r=t.split("#");o=r&&2==r.length&&r[0]==i?parseInt(r[1]):0}return o},sendMessage:function(e,t){var o=this,a=null;a="closed"==e?{command:"encourage_dialog_closed",data:t}:"paid"==e?{command:"encourage_paid",data:t}:{command:e,data:t},o.message&&o.message(a)},handleError:function(e){if(e){var t=this,o=t.errors[e];return 11e4==e?void t.viewUtil.OpenLoginDialog():void t.viewUtil.displayPaymentError(o?o:"\u672a\u77e5\u9519\u8bef")}}}});_.Module.define({path:"encourage-blue/widget/send_gift_success",requires:[],sub:{URL:{getGiftTab:"/present/getForumRank"},giftMap:{},initial:function(s){this.toUser=s.userId,this.toUserName=s.userName,this.scene_from=s.scene_from,this.initDialog()},getDialogTpl:function(){var s=this,i=_.template('<div class="send-gift-success-container" j-send-gift-success-container>     <h2>\u8d60\u9001\u6210\u529f</h2>     <span class="send-gift-success-close"></span>     <p class="send-gift-success-total">\u6211\u9001\u7684\u793c\u7269\u603b\u4ef7\u503c: <span></span></p>     <p class="send-gift-success-line"></p>     <div class="send-gift-success-raking" j-send-gift-success-raking>         <span class="txt">\u7b2c</span>         <span><i></i></span>         <span><i></i></span>         <span><i></i></span>         <span class="txt">\u540d</span>         <div class="num_box">             <div class="num"></div>             <div class="num"></div>             <div class="num"></div>         </div>     </div>     <p class="send-gift-success-mine" j-send-gift-success-mine>\u6211\u5728\u672c\u5427\u6392\u540d\uff1a<em class="res"></em></p>     <p class="send-gift-success-gray">\u8fd8\u5dee<em></em>\u9b45\u529b\u503c\u53ef\u8d85\u8d8a\u524d\u4e00\u540d</p>     <a href="javascript:;" class="send-gift-success-btn" j-send-gift-success-btn>\u786e \u5b9a</a> </div> ')({name:s.toUserName});return i},initDialog:function(){var s=this,i=s.getDialogTpl(),t={modal:!0,fixed:!0,width:254,height:290,hideOnclose:!1,holderClassName:"send-gift-success",draggable:!1,html:i,closeable:!1,showTitle:!1};s._gift_dialog=new $.dialog(t),s.$_gift_dialog=s._gift_dialog.element,s.showDialog(function(){s.getGiftList()}),s.bindEvent()},showDialog:function(s){var i=this;i.top||(i.top=Number(i.$_gift_dialog.css("top").replace("px",""))),i.$_gift_dialog.css({height:0,top:(i.top+290)/2}).animate({height:290,top:i.top,display:"block"},function(){i.$_gift_list=i.$_gift_dialog.find(".send-gift-success-container"),s&&s()})},closeDialog:function(s){var i=this;i.$_gift_dialog.animate({height:0,top:(i.top+290)/2,display:"none"},function(){s&&s()})},getGiftList:function(s){var i=this;$.ajax({url:i.URL.getGiftTab,data:{forum_id:window.PageData.forum.id},type:"GET",dataType:"json",success:function(t){if(0==t.no){var n=t.data;i.$_gift_dialog.find(".send-gift-success-total span").html(n.info.my_scores),i.$_gift_dialog.find(".send-gift-success-mine em").html(n.info.my_pos),1==n.info.my_pos?i.$_gift_dialog.find(".send-gift-success-gray").html("\u60a8\u5df2\u662f\u672c\u5427\u9001\u793c\u7269\u4ef7\u503c\u7b2c\u4e00\u540d"):i.$_gift_dialog.find(".send-gift-success-gray em").html(n.info.my_diff),i.setAnimation(),s&&s()}else i.errorTips()},error:function(){i.errorTips()}})},setAnimation:function(){var s=$("[j-send-gift-success-raking]"),i=$("[j-send-gift-success-mine]"),t=16;s.find(".num").css("backgroundPositionY",0);var n=i.find(".res").html(),e=String(n),a=null;a=1==e.length?"00"+n:2==e.length?"0"+n:n;var c=(a+"").split("");$.each(s.find(".num"),function(s){var i=$(this);setTimeout(function(){i.animate({backgroundPositionY:60*t-t*c[s]})},300*s)})},bindEvent:function(){var s=this;s.$_gift_dialog.on("click",".send-gift-success-close",function(){s.closeDialog(function(){s._gift_dialog.close()})}).on("click","[j-send-gift-success-btn]",function(){s.closeDialog(function(){s._gift_dialog.close()})})}}});_.Module.define({path:"encourage-blue/widget/gift_page_ctrl",sub:{giftMap:[],emptyListTpl:"<p>\u8be5\u7c7b\u76ee\u4e0b\u8fd8\u6ca1\u6709\u793c\u7269\uff0c\u8bf7\u9009\u62e9\u5176\u4ed6\u7c7b\u76ee~</p>",initial:function(t){this.giftList=t.giftList,this.$container=t.$container,this.rendTpl(),$.isEmptyObject(t.giftList)?this.emptyList():(this.formateData(),this.rendList(),this.rendPoint(),this.updateCursor(),this.updateView(),this.addEvents())},emptyList:function(){var t=this.emptyListTpl;this.$container.html(t)},pointTpl:function(t){var i=0,e="";for(i;t>i;i++)e+='<a href="javascript:;" class="btn-point j-gift-page" id="btn-point-'+i+'" data-page="'+i+'"><i></i></a>';return e},formateData:function(){var t=this,i=0;$.each(t.giftList,function(e,a){i++;var s=i%10,r=Math.floor(i/10);if(0==s&&r--,t.giftMap[r]||(t.giftMap[r]=[]),1==a.activity_type){var n=a.begin_time,p=a.end_time,c=Math.round((new Date).getTime()/1e3);a.is_time_limit=n>c?1:c>p?2:0}t.giftMap[r].push(a)});var e=t.giftMap[t.giftMap.length-1],a=e.length,s=5-a%5;if(5!=s)for(s;s>0;s--)e.push({})},rendTpl:function(){var t=_.template('<div class="gift-center-page">     <div class="gift-center-page-list"></div> </div> <a href="javascript:;" class="gift-center-box-cursor left j-gift-page" data-page="left"></a> <a href="javascript:;" class="gift-center-box-cursor gift-right j-gift-page" data-page="right"></a> <div class="gift-center-box-point"></div>')();this.$container.html(t),this.$pageList=this.$container.find(".gift-center-page-list"),this.$pageCursor=this.$container.find(".j-gift-page")},rendList:function(){var t=_.template("<% for (var itemList in list) {     var len = list[itemList].length;     var type = len/5;     var height = type * 126;     %> <ul class=\"gift-center-list\" id=\"gift-center-list-<%=itemList%>\" style=\"height:<%=height%>px\">     <% for (var i in list[itemList]) {          var item = list[itemList][i];         var type = '';         var timeLimit = 0;         switch (Number(item['activity_type'])) {             case 1 : {                 type = 'time';                 break;             }             case 2 : {                 type = 'num';                 break;             }             case 3 : {                 type = 'sale';                 break;             }             case 4 : {                 type = 'member';                 break;             }             case 5 : {                 type = 'free';                 break;             }         }         if (type == 'time') {             if (item['is_time_limit'] != 0) {                 type = 'time-limit';                 timeLimit = item['is_time_limit'];             }         }         if (item['large_thumbnail_url']) {             var category_id = item['category_id']['category_id'] || item['category_id'];             var tdouNum = 0;             if (item['activity_type'] == 3) {                 tdouNum = item['discount'];             } else {                 tdouNum = item['price'];             }     %>     <li class=\"gift-center-list-item\">         <a href=\"javascript:;\" class=\"gift-center-list-item-link\" id=\"gift-center-list-item-<%=item['gift_id']%>\" data-gift={\"gift_id\":\"<%=item['gift_id']%>\",\"category_id\":\"<%=category_id%>\",\"tdou\":\"<%=tdouNum%>\",\"active\":\"<%=item['activity_type']%>\",\"timeLimit\":\"<%=timeLimit%>\"}>             <img class=\"gift-center-list-item-link-img\" alt=\"<%=item['gift_desc']%>\" src=\"<%=item['large_thumbnail_url']%>\">             <p class=\"gift-center-list-item-link-name\"><%=item['gift_name']%></p>             <div class=\"gift-center-list-item-link-detail\">                 <p class=\"text-overflow\">\u5bf9\u65b9\u83b7\u5f97<%=item['gift_name']%></p>                 <p class=\"text-overflow\">                     <i class=\"icon-tbean\"></i>                     <% if (item['activity_type'] == 3) {%>                     <span class=\"del\"><%=item['price']%></span><span><%=item['discount']%></span>                     <% } else { %>                     <span><%=item['price']%></span>                     <% } %>                 </p>             </div>             <i class=\"icon-select\"></i>             <i class=\"icon-type <%=type%>\"></i>         </a>     </li>     <%} else {%>     <li class=\"gift-center-list-item empty\"></li>     <% } %>     <% } %> </ul> <% } %>")({list:this.giftMap});this.$pageList.html(t),this.setAnimation(),this.page=0},rendPoint:function(){var t=this.giftMap.length;this.total=t-1;var i=this.pointTpl(t);this.$container.find(".gift-center-box-point").html(i),this.$pageList.css({width:631*t})},updateCursor:function(){var t=this.giftMap.length;1==t?this.$pageCursor.remove():this.$pageCursor.eq(0).hide()},updateView:function(){var t=this.page;this.$container.find(".btn-point.active").removeClass("active"),this.$container.find(".btn-point").eq(t).addClass("active"),0==this.page?(this.$pageCursor.eq(0).hide(),this.$pageCursor.eq(1).show()):this.page==this.total?(this.$pageCursor.eq(1).hide(),this.$pageCursor.eq(0).show()):this.$pageCursor.show()},moveToPage:function(){var t=this.page;this.$pageList.animate({"margin-left":631*t*-1})},pagerCtrl:function(t){var i=this;switch(t){case"left":if(0==i.page)return;i.page--,i.updateView(),i.moveToPage();break;case"right":if(i.page==i.total)return;i.page++,i.updateView(),i.moveToPage();break;default:var e=Number(t);if(e>=0){if(e==i.page)return;i.page=e,i.updateView(),i.moveToPage()}}},setAnimation:function(){var t=this.$container.find(".gift-center-list-item"),i=100;$.each(t,function(t,e){i+=50,setTimeout(function(){$(e).addClass("show")},i)})},addEvents:function(){var t=this;t.$container.on("click",".j-gift-page",function(i){var e=$(i.currentTarget),a=e.data("page");t.pagerCtrl(a)})}}});_.Module.define({path:"encourage-blue/widget/gift_loading_css",sub:{initial:function(){},getTpl:function(){return _.template('<div class="gift-loading">     <div class="object object_one"></div>     <div class="object object_two"></div>     <div class="object object_three"></div>     <div class="object object_four"></div> </div>')()}}});_.Module.define({requires:["encourage-blue/widget/gift_loading_css","user/widget/user_api","encourage-payment/widget/baseUserData","encourage-blue/widget/gift_page_ctrl","encourage-blue/widget/send_gift_success","encourage-payment/widget/tdou_view_pay","encourage-payment/widget/tcharge_dialog"],path:"encourage-blue/widget/send_gift_dialog",equires:["encourage-blue/widget/gift_page_ctrl","encourage-blue/widget/send_gift_success","user/widget/user_api","encourage-payment/widget/tcharge_dialog","encourage-payment/widget/tdou_view_pay","encourage-payment/widget/baseUserData","encourage-blue/widget/gift_loading_css"],sub:{URL:{getGiftTab:"/present/show/getGiftList",getGiftForTab:"/present/show/getGiftListByCategoryId",getFreeGift:"/present/show/getUserFreeChance",sendGift:"/present/pay/placeOrder"},dialogHeight:560,giftMap:{},initial:function(t){return this.accountId=t.account_id,this.accountType=t.account_type,this.accountName=t.account_name,this.toUser=t.userId,this.toUserName=t.userName,this.scene_from=t.scene_from,this.threadId=t.threadId||null,this.postId=t.postId||null,this.forumName=window.PageData.forum.Name,this.fromUser=window.PageData.user.id,this.canSendToSelf=t.canSendToSelf,this.onFail=t.onFail||function(){},this.onSucess=t.onSucess||function(){},this.getUserTdou(),this.$loadingTpl=this.requireInstance("encourage-blue/widget/gift_loading_css").getTpl(),this.userLevel=this.requireInstance("user/widget/user_api").checkSuperMemberShipOf(PageData.user),this.fromUser?t.toUser!=this.fromUser||this.canSendToSelf?(this.initDialog(),void 0):(this.onFail({no:1,msg:"\u4e0d\u80fd\u7ed9\u81ea\u5df1\u9001\u793c\u7269\u54e6~"}),void 0):(this.onFail({no:210009,msg:"\u8bf7\u767b\u5f55~"}),void 0)},getUserTdou:function(t){this.baseUserData||(this.baseUserData=this.requireInstance("encourage-payment/widget/baseUserData")),this.baseUserData.getTdou(function(e){this.userTdou=e.data.Parr_scores.scores_total,t&&t()},this)},getDialogTpl:function(){var t=_.template('<div class="gift-center-dialog-container">     <div class="gift-center-title">         <h4>\u9001\u7ed9<%=name%></h4>         <a href="javascript:;" class="dialogJclose j-gift-center-title-close"></a>     </div>     <div class="gift-center-box">         <div class="gift-center-box-tab">         </div>         <div class="gift-center-box-list">             <div class="gift-loading"><span></span></div>         </div>     </div> </div> <div class="gift-center-dialog-cashier">     <div class="gift-tr gift-center-dialog-cashier-num">         <p>\u9009\u62e9\u6570\u91cf\uff1a</p>         <div class="gift-cashier-num-item">             <a href="javascript:;" class="j-gift-num" data-num="1">1</a>             <a href="javascript:;" class="j-gift-num" data-num="99">99</a>             <a href="javascript:;" class="j-gift-num" data-num="520">520</a>             <a href="javascript:;" class="j-gift-num" data-num="999">999</a>             <a href="javascript:;" class="j-gift-num" data-num="1314">1314</a>             <a href="javascript:;" class="j-gift-num gift-num-input" data-num="0">                 <input type="text" class="j-gift-num-input" maxlength="4" placeholder="\u81ea\u5b9a\u4e49" />             </a>         </div>     </div>     <div class="gift-tr gift-center-dialog-cashier-price">         <p>\u6240\u9700T\u8c46\uff1a</p>         <div class="gift-center-price">             <i class="icon-tbean"></i>             <span class="gift-center-price-tbean j-gift-price">0</span>             <!-- <span class="gift-center-price-detail">\uff08\u5bf9\u65b9\u83b7\u5f97<i class="icon_tbean"></i><span>0</span>\uff09</span>             <a href="/f?ie=utf-8&kw=\u84dd\u94bb&fr=gift" target="_blank" class="gift-center-price-tips">\u84dd\u94bb\u7528\u9014</a> -->         </div>     </div>     <div class="gift-tr gift-center-dialog-cashier-btn">         <a href="javascript:;" class="btn-gift-send disabled">\u8d60\u9001</a>         <span class="error-tips"></span>         <span class="txt-tips"></span>     </div> </div> <div class="gift-center-dialog-alert">     <div class="mask"></div>     <div class="loading">         <span></span>         <p>\u5151\u6362\u793c\u7269\u4e2d\uff0c\u8bf7\u7a0d\u5019~</p>     </div>     <div class="alert update-tdou">         <p>\u8d2d\u4e70T\u8c46\u6210\u529f\uff0c\u8bf7\u5237\u65b0\u3002</p>         <a href="javascript:;" class="j-update-tdou">\u5237\u65b0</a>         <a href="javascript:;" class="j-close-alert">\u5173\u95ed</a>     </div>     <div class="alert toast toast-error">         <i></i>         <span>\u8d60\u9001\u5931\u8d25\uff01</span>     </div>     <div class="alert toast toast-suc">         <i></i>         <span>\u8d60\u9001\u6210\u529f\uff01</span>     </div> </div>')({name:window.PageData.forum.name});return t},initDialog:function(){var t=this,e=t.getDialogTpl(),i={modal:!0,fixed:!0,width:690,height:t.dialogHeight,hideOnclose:!1,holderClassName:"gift-center-dialog",draggable:!1,html:e,closeable:!1,showTitle:!1};t._gift_dialog=new $.dialog(i),t.$_gift_dialog=t._gift_dialog.element,t.$success=t.$_gift_dialog.find("gift-center-dialog-container"),t.$inputCtrl=t.$_gift_dialog.find(".j-gift-num-input"),t.$numCtrl=t.$_gift_dialog.find(".j-gift-num"),t.$btnCtrl=t.$_gift_dialog.find(".btn-gift-send"),t.$tdouView=t.$_gift_dialog.find(".j-gift-price"),t.$blueView=t.$_gift_dialog.find(".gift-center-price-detail span"),t.$blueIcon=t.$_gift_dialog.find(".gift-center-price-detail i"),t.$errorTips=t.$_gift_dialog.find(".error-tips"),t.$txtTips=t.$_gift_dialog.find(".txt-tips"),t.$alertCenter=t.$_gift_dialog.find(".gift-center-dialog-alert"),t.$blueTips=t.$_gift_dialog.find(".gift-center-price-tips"),t.showDialog(function(){t.getGiftList(function(){t.setDefaultGift()})}),t.bindEvent()},setDefaultGift:function(){var t=this;setTimeout(function(){t.$_gift_dialog.find(".gift-center-box-list .gift-center-list-item-link").eq(0).click(),t.$_gift_dialog.find(".j-gift-num").eq(0).click()},1e3)},showDialog:function(t){var e=this;e.top||(e.top=Number(e.$_gift_dialog.css("top").replace("px",""))),e.$_gift_dialog.css({height:0,top:(e.top+e.dialogHeight)/2}).animate({height:e.dialogHeight,top:e.top,display:"block"},function(){e.$_gift_list||(e.$_gift_list=e.$_gift_dialog.find(".gift-center-dialog-container")),t&&t()})},closeDialog:function(t){var e=this;e.$_gift_dialog.animate({height:0,top:(e.top+e.dialogHeight)/2,display:"none"},function(){t&&t()})},getGiftList:function(t){var e=this;$.ajax({url:e.URL.getGiftTab,data:{scene_from:e.scene_from},type:"GET",dataType:"json",success:function(i){0==i.no?(e.rendGiftTpl(i.data),e.addFreeUrl=i.data.addfree_url,e.currency=i.data.currency,t&&t()):e.errorTips()},error:function(){e.errorTips()}})},errorTips:function(t){var e=this;switch(t){case"member":e.$txtTips.html('\u53ea\u6709\u4f1a\u5458\u624d\u53ef\u4ee5\u8d2d\u4e70<a href="javascript:;" class="j-get-member">\u8d2d\u4e70\u4f1a\u5458</a>');break;case"timeLimit":1==e.timeLimit?e.$errorTips.html("* \u9650\u65f6\u793c\u7269\u8fd8\u672a\u4e0a\u67b6"):2==e.timeLimit&&e.$errorTips.html("* \u9650\u65f6\u793c\u7269\u5df2\u4e0b\u67b6");break;case"tdou":e.$txtTips.html('\u60a8\u7684T\u8c46\u4e0d\u8db3<a href="javascript:;" class="j-get-tdou">\u83b7\u53d6T\u8c46</a>');break;case"timeIn":var i=e.curGift.end_time,a=Math.round((new Date).getTime()/1e3),s=i-a,r=Math.floor(s/86400),n=Math.floor(s%86400/3600),c=Math.floor(s%86400%3600/60);e.$txtTips.html("\u9650\u65f6\u9500\u552e\uff1a\u8fd8\u6709"+r+"\u5929"+n+"\u5c0f\u65f6"+c+"\u5206\u949f\u7ed3\u675f");break;case"free":$.ajax({url:e.URL.getFreeGift,data:{scene_from:e.scene_from},type:"GET",success:function(t){0==t.no?(e.limitNum=t.data.free_chance,e.freeCtrl(),e.$txtTips.html('\u60a8\u6700\u591a\u53ef\u4ee5\u514d\u8d39\u8d60\u9001<i class="num">'+t.data.free_chance+'</i>\u4e2a<a href="'+e.addFreeUrl+'" class="j-get-free-gift">\u83b7\u53d6\u673a\u4f1a</a>')):e.$txtTips.html('\u60a8\u6700\u591a\u53ef\u4ee5\u514d\u8d39\u8d60\u9001<i class="num">0</i>\u4e2a<a href="'+e.addFreeUrl+'" class="j-get-free-gift">\u83b7\u53d6\u673a\u4f1a</a>')},error:function(){e.$txtTips.html('\u60a8\u6700\u591a\u53ef\u4ee5\u514d\u8d39\u8d60\u9001<i class="num">0</i>\u4e2a<a href="'+e.addFreeUrl+'" class="j-get-free-gift">\u83b7\u53d6\u673a\u4f1a</a>')}});break;case"num":var d=e.curGift.gift_count;e.$txtTips.html('\u8be5\u793c\u7269\u9650\u91cf<i class="num">'+d+"</i>\u4e2a")}},rendGiftTpl:function(t){var e=t.list,i=t.list[0].category_id,a=t.gift_list;this.rendTab(e),this.setTab(i),this.giftListRend(i,a)},setTab:function(t){this.$tabList.removeClass("current"),$("#gift-center-tab-"+t).addClass("current")},giftListRend:function(t,e){this.setData(t,e),this.requireInstance("encourage-blue/widget/gift_page_ctrl",{giftList:e,$container:$(".gift-center-box-list")})},giftSendSuccess:function(t,e){this.requireInstance("encourage-blue/widget/send_gift_success",{giftList:e,$container:$(".gift-center-dialog-alert")})},setData:function(t,e){this.categoryId=t,this.giftMap[t]||(this.giftMap[t]={}),this.giftMap[t]=this.formateList(e)},formateList:function(t){var e={};return $.each(t,function(t,i){e[i.gift_id]=i}),e},rendTab:function(t){var e=this,i=_.template('<ul class="gift-center-tab-list">     <% var len = list.length;         var width = (630 - len) / len;         for (var i in list) {         var item = list[i];     %>     <li class="gift-center-tab-item-tr"></li>     <li class="gift-center-tab-item" style="width:<%=width%>px">         <a href="javascript:;" id ="gift-center-tab-<%=item.category_id%>" data-tab={"id":"<%=item.category_id%>"}>             <%=item.category_name%>         </a>     </li>     <%}%> </ul>')({list:t});e.$_gift_dialog.find(".gift-center-box-tab").html(i),e.$tabList=e.$_gift_dialog.find(".gift-center-box-tab").find(".gift-center-tab-item a")},selectGift:function(){var t=this;t.updateGift()},updateGift:function(){$(".gift-center-list-item-link").removeClass("select"),$("#gift-center-list-item-"+this.curGiftId).addClass("select")},setLoading:function(){this.$_gift_dialog.find(".gift-center-box-list").html(this.$loadingTpl)},changeTab:function(t){var e=this;e.setLoading(),e.giftMap&&e.giftMap[t]?(e.setTab(t),e.giftListRend(t,e.giftMap[t])):$.ajax({url:e.URL.getGiftForTab,data:{category_id:t},type:"GET",dataType:"json",success:function(i){if(0==i.no){var a=i.data.gift_list||{};e.setTab(t),e.giftListRend(t,a),e.giftMap[t]=e.formateList(a)}else e.errorTips()},error:function(){e.errorTips()}})},inputCtrl:function(t){var e=parseInt(t,10)||0;0==e?this.$inputCtrl.val(""):t!=e&&this.$inputCtrl.val(e),this.orderNum=e,this.updateBtn()},updateBtn:function(){return this.$txtTips.html(""),this.$errorTips.html(""),this.curGiftId&&this.curCategoryId?this.orderNum?(this.checkOrder()?this.$btnCtrl.removeClass("disabled"):this.$btnCtrl.addClass("disabled"),void 0):(this.$btnCtrl.addClass("disabled"),this.$tdouView.html("0"),this.$blueView.html("0"),void 0):(this.$btnCtrl.addClass("disabled"),this.$tdouView.html("0"),this.$blueView.html("0"),void 0)},setNum:function(t){this.$tdouView.html(t);var e=this.curGift,i=Math.floor((t-(e.tbkey_price||0))*(100-e.proportion)/100);this.$blueView.html(i),0==this.currency?(this.$blueIcon.removeClass().addClass("icon_tbean"),this.$blueTips.hide()):(this.$blueIcon.removeClass().addClass("icon-blue"),this.$blueTips.show())},checkOrder:function(){var t=Number(this.curTdouNum)*Number(this.orderNum);return this.setNum(t),4!=this.activeId||this.userLevel?1!=this.activeId||this.timeLimitCtrl()?t>this.userTdou?(this.tdouNotEnough(),!1):(2==this.activeId&&this.numLimitCtrl(),3==this.activeId&&this.saleCtrl(),5==this.activeId&&this.errorTips("free"),!0):!1:(this.notMember(),!1)},freeCtrl:function(){var t=this.limitNum,e=this.orderNum;e>t&&this.$btnCtrl.addClass("disabled")},notMember:function(){this.errorTips("member")},timeLimitCtrl:function(){return 0!=this.timeLimit?(this.errorTips("timeLimit"),!1):(this.errorTips("timeIn"),!0)},numLimitCtrl:function(){var t=this.curGift,e=t.gift_count;return this.errorTips("num"),e<this.orderNum?!1:!0},saleCtrl:function(){var t=this.curGift.price*Number(this.orderNum),e=Number(this.curTdouNum)*Number(this.orderNum);return this.$txtTips.html('\u6298\u6263\u4fc3\u9500\uff1a\u539f\u4ef7<i class="del">'+t+'</i>T\u8c46\uff0c\u73b0\u4ef7<i class="num">'+e+"</i>T\u8c46"),!0},tdouNotEnough:function(){this.errorTips("tdou")},sendGifterror:function(){var t=this;t.$alertCenter.show().find(".loading").hide(),t.$alertCenter.find(".toast-error").show(),setTimeout(function(){t.$alertCenter.hide().find(".toast-error").hide()},1e3)},sendGiftSuc:function(){var t=this;t.$alertCenter.show().find(".loading").hide(),t.$alertCenter.hide().find(".toast-suc").hide()},getOrder:function(){var t=this;t.$btnCtrl.addClass("disabled"),t.$alertCenter.show().find(".loading").show();var e={scene_from:t.scene_from,gift_id:t.curGiftId,num:t.orderNum,benefit_userid:t.toUser,benefit_username:t.toUserName,thread_id:t.threadId,post_id:t.postId};t.accountId&&t.accountType&&(e.account_type=t.accountType,e.account_id=t.accountId,e.benefit_userid=t.accountId,e.benefit_username=t.accountName),$.ajax({url:t.URL.sendGift,data:e,type:"POST",dataType:"json",success:function(e){if(0==e.no)if(5==t.activeId)t.sendGiftSuc(),t.giftSendSuccess(),t.limitNum=e.data.free_chance,t.freeCtrl(),t.$txtTips.html('\u60a8\u6700\u591a\u53ef\u4ee5\u514d\u8d39\u8d60\u9001<i class="num">'+e.data.free_chance+'</i>\u4e2a<a href="'+t.addFreeUrl+'" class="j-get-free-gift">\u83b7\u53d6\u673a\u4f1a</a>'),t.$btnCtrl.removeClass("disabled");else{var i=e.data;$.extend(i,{chargeType:"platform",notShowSucTips:!0});var a=t.requireInstance("encourage-payment/widget/tdou_view_pay",function(i){if("encourage_dialog_closed"==i.command?t.$alertCenter.hide().find(".loading").hide():"encourage_paid"==i.command?0==i.data.no?(t.sendGiftSuc(),t.giftSendSuccess()):t.sendGifterror():t.sendGifterror(),2==t.activeId){var a=e.data.gift_count;t.curGift.gift_count=a,t.numLimitCtrl()?t.$btnCtrl.removeClass("disabled"):t.$btnCtrl.addClass("disabled")}else t.$btnCtrl.removeClass("disabled")});a.createMain(i)}else t.$btnCtrl.removeClass("disabled"),t.sendGifterror()},error:function(){t.$btnCtrl.removeClass("disabled"),t.sendGifterror()}})},updateTdou:function(){var t=this.orderNum*this.curTdouNum-this.userTdou,e={consumption_path:"send-gift",fr:"send-gift",current_need_tdou:t,is_direct_cashier:!0};this.requireInstance("encourage-payment/widget/tcharge_dialog",e),setTimeout(function(){this.$alertCenter.show().find(".update-tdou").show()},1e3)},bindEvent:function(){var t=this;t.$_gift_dialog.on("click",".j-gift-center-title-close",function(){t.closeDialog(function(){t._gift_dialog.close()})}).on("click",".gift-center-list-item-link",function(e){var i=$(e.currentTarget),a=i.data("gift");t.curGiftId=a.gift_id,t.curCategoryId=a.category_id,t.curTdouNum=a.tdou,t.activeId=a.active,t.timeLimit=a.timeLimit,t.curGift=t.giftMap[t.curCategoryId][t.curGiftId],t.selectGift(),t.updateBtn()}).on("click",".gift-center-tab-item a",function(e){var i=$(e.currentTarget),a=i.data("tab"),s=a.id;t.changeTab(s),t.curCategoryId=null,t.curGiftId=null,t.curTdouNum=null,t.activeId=null,t.timeLimit=null,t.updateBtn()}).on("input",".j-gift-num-input",function(e){var i=$(e.currentTarget),a=i.val();t.inputCtrl(a)}).on("click",".j-gift-num",function(e){var i=$(e.currentTarget);t.$numCtrl.removeClass("select"),i.addClass("select");var a=Number(i.data("num"))||0;t.orderNum=a,0==a?(t.$inputCtrl.focus(),t.inputCtrl(t.$inputCtrl.val())):(t.$inputCtrl.val(""),t.updateBtn())}).on("click",".btn-gift-send",function(e){var i=$(e.target);i.hasClass("disabled")||t.getOrder()}).on("click",".j-get-tdou",function(){t.updateTdou()}).on("click",".j-close-alert",function(){t.$alertCenter.hide().find(".alert").hide()}).on("click",".j-update-tdou",function(){t.getUserTdou(function(){t.checkOrder(),t.$alertCenter.hide().find(".alert").hide()})})}}});_.Module.define({requires:["encourage-blue/widget/send_gift_dialog"],path:"encourage-blue/widget/raking_gift_dialog",sub:{URL:{getUserGiftList:"/present/getForumRank"},$emptyTpl:'<p class="tips-none" j-send-gift><a href="javascript:;">\u5feb\u6765\u6210\u4e3a\u7b2c\u4e00\u4e2a\u9001\u793c\u7269\u7684\u4eba\u5427</a></p>',$errorTpl:'<p class="tips">\u7cfb\u7edf\u9519\u8bef\uff0c\u8bf7\u5237\u65b0\u540e\u518d\u8bd5~</p>',emptyObject:{},giftData:{},initial:function(i){this.homeUserId=i.homeUserId,this.callBack=i.callBack,this.isUserHome=i.homeUserId==window.PageData.user.id||i.userId==window.PageData.user.user_id?!0:!1,this.initDialog(),this.addEvents(),this.isUserId=i.isUserId},getDialogTpl:function(){var i='<div class="raking-center-dialog-top">\u672c \u5427 \u8d21 \u732e \u699c</div>',t='<div class="raking-center-dialog-close"></div>',a='<div class="raking-center-dialog-con"></div>';return'<div class="raking-center-dialog-container">'+i+t+a+"</div>"},initDialog:function(){var i=this,t=i.getDialogTpl(),a={modal:!0,fixed:!0,width:750,height:500,hideOnclose:!1,holderClassName:"raking-center-dialog",draggable:!1,html:t,closeable:!1,showTitle:!1};i._gift_dialog=new $.dialog(a),i.$_gift_dialog=i._gift_dialog.element,i.showDialog(function(){i.getGiftList()})},showDialog:function(i){var t=this;t.top||(t.top=Number(t.$_gift_dialog.css("top").replace("px",""))),t.$_gift_dialog.css({height:0,top:(t.top+500)/2}).animate({height:500,top:t.top,display:"block"},function(){t.$_gift_list||(t.$_gift_list=t.$_gift_dialog.find(".raking-center-dialog-con")),i&&i()})},closeDialog:function(i){var t=this;t.$_gift_dialog.animate({height:0,top:(t.top+500)/2,display:"none"},function(){i&&i()})},setLoading:function(){this.$_gift_list.html(this.$loadingTpl)},getGiftList:function(i,t,a){var e,n=this,o=n.URL.getUserGiftList;n.giftData[i]&&n.giftData[i][t]&&!n.shouldReload?(e=n.giftData[i][t],a&&a(e),n.rendList(i,e.gift_list)):$.ajax({url:o,data:{forum_id:window.PageData.forum.id,pn:t||0,ps:8},type:"GET",dataType:"json",success:function(e){if(0==e.no){var o=e.data;if(n.shouldReload=!1,$.isEmptyObject(e.data.gift_list))return n.errorTips("empty"),void 0;if(a&&a(e.data),n.rendList(i,e.data.gift_list),n.setData(i,t,e.data),n.$_gift_dialog.find(".raking-center-dialog-username").addClass("current"),e.data.info){n.$_gift_dialog.find(".raking-center-dialog-title-txt em").html(o.info.my_scores),n.$_gift_dialog.find(".raking-center-dialog-title-txt b").html(o.info.my_pos),n.$_gift_dialog.find(".raking-center-dialog-title-rak span").html(o.info.my_diff);var s=n.$_gift_dialog.find(".raking-center-dialog-title-txt b").html();"1"==s&&n.$_gift_dialog.find(".raking-center-dialog-title-rak").html("\u60a8\u5df2\u662f\u672c\u5427\u9001\u793c\u7269\u4ef7\u503c\u7b2c\u4e00\u540d")}else n.$_gift_dialog.find("#raking-center-dialog-header").html("")}else n.errorTips("error")},error:function(){n.errorTips("error")}})},setData:function(i,t,a){$.isEmptyObject(this.giftData[i])&&(this.giftData[i]={}),this.giftData[i][t]=a},errorTips:function(i){var t="empty"===i?this.$emptyTpl:this.$errorTpl;this.$_gift_list.html(t)},rendList:function(i,t){var a=this,e=_.template('<ul class="raking-center-dialog-main-list">     <% for (var i in list) {          var item = list[i];              %>         <li>             <% if (i == 0) {%>                <span class="raking-center-dialog-main-num raking-center-dialog-main-num-one"><%=item[\'pos\']%></span>             <% } else if (i == 1) { %>                 <span class="raking-center-dialog-main-num raking-center-dialog-main-num-two"><%=item[\'pos\']%></span>             <% } else if (i == 2) { %>                 <span class="raking-center-dialog-main-num raking-center-dialog-main-num-three"><%=item[\'pos\']%></span>               <% } else { %>                 <span class="raking-center-dialog-main-num"><%=item[\'pos\']%></span>             <% } %>             <img src="https://web.archive.org/web/20201119054109/https://gss0.bdstatic.com/6LZ1dD3d1sgCo2Kml5_Y_D3/sys/portrait/item/<%=item.portrait %>" alt="" class="raking-center-dialog-main-img" />             <div class="raking-center-dialog-title title">                 <p class="txt raking-center-dialog-username"><%=item[\'pay_username_formate\']%></p>                 <p>\u9b45\u529b\u503c\uff1a<%=item[\'present_scores\']%></p>             </div>         </li>              <% } %> </ul> ')({list:a.formatData(t),isUserHome:a.isUserHome,type:i}),n=_.template('<div class="raking-center-dialog-title" id="raking-center-dialog-header" j-raking-center-dialog>     <p class="raking-center-dialog-title-txt">         <span>\u6211\u7684\u9b45\u529b\u503c\uff1a<em></em></span>\u6392\u540d\uff1a<b></b>     </p>     <p class="raking-center-dialog-title-rak">\u8fd8\u5dee<span></span>\u9b45\u529b\u503c\u8d85\u8fc7\u524d\u4e00\u540d</p> </div> <div class="raking-center-dialog-main"> </div>')({list:a.formatData(t),isUserHome:a.isUserHome,type:i});a.$_gift_dialog.find(".raking-center-dialog-con").show().append(n),a.$_gift_dialog.find(".raking-center-dialog-main").show().append(e)},formatData:function(i){i.length;return $.each(i,function(i,t){if(t.create_time){var a=new Date(1e3*Number(t.create_time));t.formate_date=a.toISOString().split("T")[0]}if(t.gift_name){var e=t.gift_name;e=e.length>6?e.slice(0,5)+"...":e,t.gift_name_formate=e}if(t.pay_username){var e=t.pay_username;e=e.length>6?e.slice(0,5)+"...":e,t.pay_username_formate=e}}),i},addEvents:function(){var i=this;i.$_gift_dialog.on("click",".raking-center-dialog-close",function(){i.closeDialog(function(){i._gift_dialog.close()})}).on("click","[j-send-gift]",function(){i.closeDialog(function(){i._gift_dialog.close()}),i.requireInstance("encourage-blue/widget/send_gift_dialog",{userId:window.PageData.user.id,userName:window.PageData.user.name,scene_from:"pc_home",account_id:window.PageData.forum.id,account_name:window.PageData.forum.name,account_type:1,onSuccess:function(){$.tb.location.reload()},onFail:function(){$.tb.location.reload()}})})}}});_.Module.define({path:"encourage-blue/widget/gift_batou_goin",requires:["encourage-blue/widget/raking_gift_dialog","encourage-blue/widget/send_gift_dialog"],sub:{URL:{getUserGiftList:"/present/getForumRank"},initial:function(i){this.opts=i,this.$container=$(i.$container),this.getGiftList(),this.bindEvents()},getGiftList:function(){var i=this,t={user_id:window.PageData.user.id,forum_id:window.PageData.forum.id,pn:0,ps:4,type:1};$.get(i.URL.getUserGiftList,t,function(t){if(t&&0==t.no){var e=t.data.gift_list;i.renderGiftList(e)}})},formateData:function(i){var t=[];$.each(i,function(i,e){t.push(e)});var e=t.length;return e>4&&(t.length=4),t},renderGiftList:function(i){var t=this;i=t.formateData(i);var e=_.template('<% for (var i in list) {      var item = list[i];      if (item.num == 0 ) {  %>  <li class="check-gift-item">      <span class="offsate-gift-item-img"></span>      <p class="offsate-gift-item-info"></p>  </li>  <%} else {%>  <li class="check-gift-item">      <img src="https://web.archive.org/web/20201119054109/https://gss0.bdstatic.com/6LZ1dD3d1sgCo2Kml5_Y_D3/sys/portrait/item/<%=item.portrait %>" alt=""/>  </li>  <% }   }%>')({list:i});t.$container.find(".gift-goin-con-check-list").show().append(e)},bindEvents:function(){var i=this;i.$container.on("click","[j-check-gift]",function(){0==window.PageData.user.is_login?_.Module.use("common/widget/LoginDialog",["","userBar"]):i.requireInstanceAsync("encourage-blue/widget/raking_gift_dialog",{homeUserId:window.PageData.user.id})}).on("click",".j-goin-gift",function(){i.requireInstance("encourage-blue/widget/send_gift_dialog",{userId:window.PageData.user.id,userName:window.PageData.user.name,account_name:window.PageData.forum.name,account_id:window.PageData.forum.id,account_type:1,scene_from:"pc_home",onSuccess:function(){$.tb.location.reload()},onFail:function(){$.tb.location.reload()}})})}}}),$(function(){function i(){$(".gift-goin-left").stop().animate({width:"50px"},3e3),$(".gift-goin-con").stop().animate({width:"0"},3e3)}setTimeout(i,3e3),$(".gift-goin-left").hover(function(){$(".gift-goin-left").stop().animate({width:"248px"},1e3),$(".gift-goin-con").stop().animate({width:"198px"},1e3),$(".gift-goin-con-start").css({display:"none"}).siblings("div").css("display","block")},function(){i()})});_.Module.define({path:"forum/pagelet/focus_btn",sub:{initial:function(n){this.initialEvent(n)},initialEvent:function(n){n.on("like_status_update",function(t){$(n.document).addClass("pagelet-loading"),n.refresh({url:t.url}).then(function(){$(n.document).removeClass("pagelet-loading")})})}}});_.Module.define({path:"tbui/widget/js_redirect",requires:[],sub:{_track:function(e,a,t,o,n){t&&"object"==typeof t&&(n=t,t=""),o&&"object"==typeof o&&(n=o,o="");var r="frs"===t.toLowerCase()?"official/click/viewTrue":"http://"+location.host+"/official/click/viewTrue",c={client_type:"pc_web",task:a&&encodeURIComponent(a)||"",locate:e&&encodeURIComponent(e)||"",type:o&&encodeURIComponent(o)||"click",url:encodeURIComponent(document.location.href),refer:encodeURIComponent(document.referrer)};PageData&&(c.page=t||PageData.product,PageData.forum&&(c.fid=PageData.forum.id||"",c.fname=encodeURIComponent(PageData.forum.name||"")),PageData.user&&(c.uid=PageData.user.id||"",c.uname=PageData.user.name||"",c.is_new_user=PageData.user.is_new_user||""),PageData.thread&&(c.tid=PageData.thread&&PageData.thread.thread_id||""));for(var i in n)n.hasOwnProperty(i)&&(c[i]=encodeURIComponent(n[i]));c.page=c.page.toLowerCase(),$.ajax({type:"POST",url:r,data:c,dataType:"json"})}}});_.Module.define({path:"tbui/widget/conf_skin",requires:["tbui/widget/js_redirect"],sub:{conf:{},initial:function(t){this.conf=t,this.$wrap=$("body"),this.$wrap.addClass(t.bodyClass);if(parseInt(t.couplet.has_couplet)&&this.insertCouplet(),this.conf.isOnStatus){this.postTrack("VIEW_TRUE",this.conf.evlParam);var a=this.requireInstance("tbui/widget/js_redirect");a._track("p0250","ad_plat","FRS","VIEW_TRUE",this.conf.evlParamPb)}t.bg_top_pic&&this.loadImage(t.bg_top_pic)},loadImage:function(t){function a(t){function a(){var a=$(".special_conf_skin .wrap1").offset().top+136,e=a+t.height,s=$(window).scrollTop()+$(".search_main_fixed").outerHeight(),c=$(window).scrollTop()+$(window).height();if(a>s&&c>a||e>s&&c>e){if("asp"===o.conf.adtype&&null!=o.conf.asp_showurl){var n=new Image;n.src=o.conf.asp_showurl}var r=o.conf.couplet.has_couplet?1:0;$.stats.track("backdrop_ad","asp_bg_ad_"+r,o.conf.pageType,"show",{obj_id:o.conf.task_id,obj_task:"common_exp",page_type:"a006",obj_isad:1,obj_param1:o.conf.adtype,obj_floor:0}),i=!0}}var i=!1;a(),i===!1&&$(window).scroll(function(){i===!1&&a()})}var o=this,i=new Image;i.src=t;var e=setInterval(function(){if(i.complete){if("asp"===o.conf.adtype){var t=$(".special_conf_skin .wrap1").offset().top+136+i.height,s='<span class="bottom_background_admarks">\u54c1\u724c\u5e7f\u544a</span>',c=$(s).appendTo($(".special_conf_skin .wrap1")),n=($(window).width()-i.width)/2;0>n&&(n=0),c.css("top",t-29),c.css("left",n)}setTimeout(a(i),1e3),clearInterval(e)}},0)},insertCouplet:function(){var t=this,a=this.conf.couplet.couplet_info,o=this.conf.isStar?" couplet_star":"",i=['<a href="'+a.url_left+'" class="j_couplet couplet_left'+o+'" title="'+a.url_title+'" target="_blank" style="background: url('+a.left_pic+') right center no-repeat;"></a>','<a href="'+a.url_right+'" class="j_couplet couplet_right'+o+'" title="'+a.url_title+'" target="_blank" style="background: url('+a.right_pic+') left center no-repeat;"></a>'].join("");this.$couplets=$(i).click(function(){$.stats.track("backdrop_ad","asp_bg_ad_1",t.conf.pageType,"click",{obj_id:t.conf.task_id,obj_task:"common_click",page_type:"a006",obj_isad:1,obj_param1:t.conf.adtype,obj_floor:0})}).appendTo(this.$wrap),this.calWidth(),this.initCoupletEvent()},initCoupletEvent:function(){var t=this;$(window).on("resize",function(){t.calWidth()})},postTrack:function(t,a){var o=t?t:"VIEW_TRUE";$.stats.track("p0250","ad_plat","FRS",o,a)},calWidth:function(){var t=$(window).width(),a=1380>t?(t-980)/2:200;this.$couplets.css("width",a)}}});_.Module.define({path:"frs-footer/widget/frs_from_guide",sub:{initial:function(){var t=$.tb.location.getSearchValue().fr;"shortcut"==t&&$.stats.track("\u684c\u9762\u5feb\u6377\u65b9\u5f0f_\u8fdb\u5165","\u65b0\u7528\u6237\u7559\u5b58","frs","show")}}});!function(){var e=0;_.Module.define({path:"tbui/widget/bubble_tip",sub:{bubbles:{},initial:function(e){var i={content:"",arrow_dir:"up",bubble_css:{width:170},arrow_pos:{},attr:"",wrap:$("body"),closeBtn:!1,level:1,arrowReq:!0};this._option=$.extend(!0,i,e),this._event={},this.init()},init:function(){this.buildBubble()},buildBubble:function(){var i=this._option,t=this.genericTpl(),b=i.wrap;this.j_bubble=$(t),b.append(this.j_bubble),this.j_bubble.css(i.bubble_css),this.j_bubble.find(".j_ui_triangle").css(i.arrow_pos),this.setContent(i.content),this.j_bubble.find(".j_content").css("up"==i.arrow_dir||"down"==i.arrow_dir?{width:i.bubble_css.width}:{width:i.bubble_css.width-7}),i.closeBtn&&this.j_bubble.find(".j_close").show(),i.arrowReq||this.hideArrow(),this._bindEvent(),this.cid="bubble_"+e,e++},_bindEvent:function(){var e=this._option,i=this;e.closeBtn&&this.j_bubble.find(".j_close").click(function(){var e=i.triggerEvent("onclose");e&&i.closeBubble()})},bind:function(e,i,t){var b={stat:t?!0:!1,fun:i};this._event[e]?this._event[e].push(b):(this._event[e]=[],this._event[e].push(b))},triggerEvent:function(e){var i=!0;if(this._event[e])for(var t=this._event[e],b=0;b<t.length;b++)t[b].fun&&t[b].fun(),t[b].stat||(i=!1);return i},genericTpl:function(){var e=this._option.attr,i=this._option.arrow_dir;return _html='<div class="ui_bubble_wrap j_wrap" '+e+' style="display:none;"><div class="j_content ui_bubble_content ui_bubble_'+i+'"><div class="ui_bubble_body j_body"></div><div class="ui_bubble_closed j_close"></div></div><div class="j_ui_triangle ui_triangle ui_triangle_'+i+'"><div class="ui_triangle_outter ui_arrow_o_'+i+'" ><em>\u25c6</em></div><div class="ui_triangle_inner ui_arrow_i_'+i+'" ><em>\u25c6</em></div></div></div>'},closeBubble:function(){this.j_bubble.remove(),delete this.bubbles[this.cid]},hideArrow:function(){this.j_bubble.find(".ui_triangle").hide()},hideBubble:function(){this.j_bubble.hide()},showBubble:function(e){if(e)if(e.zIndex)this._getBubbleInfo(e.zIndex),this.j_bubble.css({"z-index":e.zIndex}),this.showByTime(e.type,e.time);else{this._getBubbleInfo();var i=this._handleCover();i||this.showByTime(e.type,e.time)}else{this._getBubbleInfo();var i=this._handleCover();i||this.j_bubble.show()}},showByTime:function(e,i){var t=this;"delayShow"==e?setTimeout(function(){t.j_bubble.show()},i):"delayClose"==e?(t.j_bubble.show(),setTimeout(function(){t.closeBubble()},i)):t.j_bubble.show()},_getBubbleInfo:function(e){var i=this,t=i.j_bubble,b=t.width();t.width(0),t.show();var s=t.offset(),n=s.top,o=s.left,l=t.find(".j_body").height()+12;t.hide(),t.width(b),i.minL=o,i.maxL=o+b+7,i.minT=n,i.maxT=n+l,e&&(i.bubbleType="inter"),this.bubbles[i.cid]=i},_isCover:function(){var e=this,i=e.cid,t=this.bubbles,b=e;for(var s in t)if(s==i||"inter"==e.bubbleType||"none"==t[s].j_bubble.get(0).style.display);else{var n=t[s];if(b.minL<n.maxL&&b.maxL>n.minL&&b.minT<n.maxT&&b.maxT>n.minT)return n}return!1},_handleCover:function(){var e=this._isCover(),i=this;if(e){var t=e._option.level,b=i._option.level;return b>t?(e.j_bubble.fadeOut("slow"),!1):!0}return!1},setBubblePosition:function(e){e&&(e.top||e.left)&&this.j_bubble.css(e)},setBubbleFixed:function(){this.j_bubble.addClass($.browser.msie&&"6.0"==$.browser.version?"ui_bubble_fixed_hack":"ui_bubble_wrap_fixed")},setBubbleNormal:function(){this.j_bubble.removeClass($.browser.msie&&"6.0"==$.browser.version?"ui_bubble_fixed_hack":"ui_bubble_wrap_fixed")},setFixedForMessage:function(){var e,i=this,t=null;e&&clearTimeout(e),$(window).bind("scroll",function(){e&&clearTimeout(e),null==t&&(t={top:parseInt(i.j_bubble.css("top"))||i.j_bubble.position().top}),e=setTimeout(function(){i._bubleFixedSet(t)},10)})},setContent:function(e){this.j_bubble.find(".j_body").html(e)},_bubleFixedSet:function(e){{var i=this,t=$(window).scrollTop();this._option}t>e.top?(i.setBubbleFixed(),$.browser.msie&&"6.0"==$.browser.version||i.j_bubble.css({top:-5}),i.j_bubble.find(".ui_triangle").hide()):(i.setBubbleNormal(),i.j_bubble.css({top:e.top}),i.j_bubble.find(".ui_triangle").show())}}})}();_.Module.define({path:"tbui/widget/tbshare_share",requires:["tbui/widget/tbcopy"],sub:{_baseConfig:{Parnter:{qqzone:{title:"QQ\u7a7a\u95f4",urlTmp:["https://web.archive.org/web/20201119054109/http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?","url=#{url}&title=#{text}&desc=#{desc}","&summary=#{summary}&site=#{site}&pics=#{pics}"].join("")},tsina:{title:"\u65b0\u6d6a\u5fae\u535a",urlTmp:["https://web.archive.org/web/20201119054109/http://service.weibo.com/share/share.php?","url=#{url}&title=#{text}","&pic=#{pics}"].join("")},renren:{title:"\u4eba\u4eba\u7f51",urlTmp:["https://web.archive.org/web/20201119054109/http://widget.renren.com/dialog/share?","resourceUrl=#{url}&srcUrl=#{url}&title=#{text}&description=","&pic=#{pics}"].join("")},tieba:{title:"\u767e\u5ea6\u8d34\u5427",urlTmp:["//web.archive.org/web/20201119054109/https://tieba.baidu.com/f/commit/share/openShareApi?","url=#{url}&title=#{text}&desc=#{desc}","&comment=#{summary}&pic=#{pics}"].join("")},weixin:{title:"\u5fae\u4fe1",urlTmp:[].join("")},copy:{title:"\u590d\u5236\u94fe\u63a5",urlTmp:[].join(""),attr:'onclick="return false;"'},douban:{title:"\u8c46\u74e3",urlTmp:["https://web.archive.org/web/20201119054109/http://www.douban.com/share/service?","href=#{url}&name=#{text}&text=#{desc}","&image=#{pics}"].join("")},tsohu:{title:"\u641c\u72d0\u5fae\u535a",urlTmp:["https://web.archive.org/web/20201119054109/http://t.sohu.com/third/post.jsp?","url=#{url}&title=#{text}","&pic=#{pics}"].join("")}},tmp:{base:['<ul class="">#{share_btns}</ul>'].join(""),btn:['<div class="tbshare_#{short_name} tbshare_icon" #{attr} title="#{title}" data-share="#{short_name}">',"#{text}",'<div class="tbshare_title_box">#{title}</div>',"</div>"].join(""),qrcode:['<div class="tbshare_qrcode_mask">','<div class="tbshare_qrcode_outer">','<div class="tbshare_qrcode_wrapper">',"<h6>\u626b\u4e00\u626b\u5206\u4eab\u5230\u5fae\u4fe1</h6>",'<div class="tbshare_qrcode_content"></div>','<div class="tbshare_qrcode_instruction">',"<p>\u6253\u5f00\u5fae\u4fe1\uff0c\u70b9\u51fb\u5e95\u90e8\u7684\u201c\u53d1\u73b0\u201d\uff0c<br/>\u4f7f\u7528\u201c\u626b\u4e00\u626b\u201d\u5373\u53ef\u5c06\u7f51\u9875\u5206\u4eab\u81f3\u670b\u53cb\u5708\u3002</p>","</div>",'<div class="tbshare_qrcode_close">&#215;</div>',"</div>","</div>",'<div class="tbshare_qrcode_triangle"></div>',"</div>"].join("")},common:{text:document.title,desc:document.title,url:$.tb.location.getHref(),pics:""}},qrcodeSize:90,classList:{normal:"tbshare_wrapper",coco:"tbshare_wrapper_theme_coco"},typeClassList:{normal:"",vertical:"vertical"},initial:function(t){if(t=$.extend({theme:"normal",type:"normal",initialQrcode:!0},t),this.className=this.classList[t.theme],this.typeClass=this.typeClassList[t.type],!t)throw new Error("no tbShare args provided");if($.getPageData("forum.forum_name",null)){var e="//web.archive.org/web/20201119054109/https://tieba.baidu.com/f?ie=utf-8&kw=";this._baseConfig.common.url=e+PageData.forum.name}this.shareContent=$.extend({},this._baseConfig.common,t.shareContent),this.$dom=this._createShareComponent(t.targets),t.initialQrcode&&(this.$qrcode=this._createQrcodeWrapper(),this.$qrcode.appendTo(this.$dom)),this._bindEvents()},getQrcode:function(){return this.$qrcode||(this.$qrcode=this._createQrcodeWrapper(),this.$qrcode.appendTo(this.$dom)),this.$qrcode},share:function(t){if("weixin"==t)return this.getQrcode().show(),!1;if("copy"==t)return prompt("\u8bf7\u6309\u4e0b Ctrl+C \u590d\u5236\u94fe\u63a5\u5230\u9ecf\u8d34\u677f",this.shareContent.url||$.tb.location.getHref()),!1;var e=this._baseConfig.Parnter[t],i=this.shareContent||this._baseConfig.common;i=this._dataEncodeURI(i),i=$.extend({},i),i.url+=encodeURIComponent("&sharefrom="+t);var r=$.tb.format(e.urlTmp,i);return window.open(r),!1},_createShareComponent:function(t){for(var e="",i="",r="",o=0,s=t.length;s>o;o++)"[object Array]"==Object.prototype.toString.call(t[o])?(i=t[o][0],r=t[o][1]):(i=t[o],r=""),this._baseConfig.Parnter[i]&&(e+=["<li>",$.tb.format(this._baseConfig.tmp.btn,{short_name:i,text:r,title:this._baseConfig.Parnter[i].title,attr:this._baseConfig.Parnter[i].attr||""}),"</li>"].join(""));var n=$.tb.format(this._baseConfig.tmp.base,{share_btns:e}),a=$("<div></div>").addClass(this.className).addClass(this.typeClass).append(n);return a},_createQrcodeWrapper:function(){var t=$(this._baseConfig.tmp.qrcode),e=$.tb.location.getHref(),i=this.qrcodeSize;return new window.QRCode(t.find(".tbshare_qrcode_content")[0],{text:e||"//web.archive.org/web/20201119054109/https://tieba.baidu.com",width:i,height:i}),t.on("click",".tbshare_qrcode_mask",function(){t.hide()}),t.on("click",".tbshare_qrcode_close",function(){t.hide()}),t},setQrcodeContent:function(t){var e=this.getQrcode().find(".tbshare_qrcode_content"),i=this.qrcodeSize,r=e.find("img"),o=this;r.length?(r.remove(),e.find("canvas").remove(),new window.QRCode(e[0],{text:t,width:i,height:i})):setTimeout(function(t){o.setQrcodeContent(t)},500,t)},_dataEncodeURI:function(t){var e={};for(var i in t)e[i]=encodeURIComponent(t[i]);return e},_bindEvents:function(){var t=this;this.$dom.on("click",".tbshare_icon",function(){var e=$(this).data("share");$.getJSON("/fex/check/isRealName",function(i){return i.data!==!1||1!==Number(PageData.user.is_login)?(e=e||"tieba",t.share(e)):void $.tb.checkRealName()})})},_lazyAddTbcopyOnce:function(t){this.tbcopy=this.requireInstance("common/widget/tbcopy",{ele:t,text:$.tb.location.getHref()})},_AddTbcopyOnce:function(){var t=this.$dom.find(".tbshare_copy");this.tbcopy=this.requireInstance("common/widget/tbcopy",{ele:t,text:$.tb.location.getHref()}),this.copyElement=this.tbcopy.getFlashElement()},_getPageImgSrc:function(t){var e=[];return $("img").each(function(i){t>i&&e.push($(this).tbattr("src"))}),e},setShareContent:function(t){return"[object Object]"==Object.prototype.toString.call(t)&&$.extend(this.shareContent,t),t&&t.url!=this.shareContent.url&&this.setQrcodeContent(this.shareContent.url),this.shareContent},hideQrcode:function(){this.getQrcode().hide()}}});_.Module.define({path:"tbui/widget/tbshare_popup",requires:["tbui/widget/tbshare_share"],sub:{_tmp:['<div class="tbshare_popup_wrapper">','<div class="tbshare_popup_enter"></div>','<div class="tbshare_popup_main clearfix"></div>',"</div>"].join(""),_sharebase_args:{theme:"coco",targets:["tieba","weixin","tsina","qqzone","copy"],initialQrcode:!1},_popup_args:{$container:null,type:"cross"},initial:function(e){if(!e)throw new Error("no tbMore args provided");this._popup_args=$.extend(this._popup_args,{$container:e.$container,type:e.type}),this._sharebase_args=$.extend(this._sharebase_args,{shareContent:e.shareContent||{},targets:e.targets,type:e.type}),this.$dom=this._createBaseDom(),this.$popupWrapper=this._createBaseMoreWrapper(),this._bindEvents(),this._popup_args.$container.append(this.$dom)},_createBaseDom:function(e){e=e||"";var t=this._tmp,s=$(t);return"vertical"==this._popup_args.type&&s.addClass("popup_vertical"),s},_createBaseMoreWrapper:function(){return this.shareInstance=this.requireInstance("tbui/widget/tbshare_share",[this._sharebase_args]),this.shareInstance.$dom.appendTo(this.$dom.find(".tbshare_popup_main")),this.$dom.find(".tbshare_popup_main")},_qrcodeShow:function(){this.shareInstance.getQrcode().show(),this.shareInstance.$dom.find(".tbshare_weixin").addClass("hover_on_qrcode")},_qrcodeHide:function(){this.shareInstance.getQrcode().hide(),this.shareInstance.$dom.find(".tbshare_weixin").removeClass("hover_on_qrcode")},_bindEvents:function(){var e=this;this.$dom.on("mouseenter",".tbshare_popup_main li",function(){$(this).find(".tbshare_weixin").length?e._qrcodeShow():e._qrcodeHide()}),this.$dom.on("mouseenter",function(t){$(this).find($(t.relatedTarget)).length||!$(t.relatedTarget).parent().length,e._qrcodeHide(),e.$popupWrapper.show()}),this.mouseenterInFlash=!1,this.$dom.on("mouseleave",function(t){var s=t.relatedTarget;if(s){if(s==e.shareInstance.copyElement)return void(e.mouseenterInFlash=!0)}else if(e.mouseenterInFlash)return;e.$popupWrapper.hide(),e._reinitialCopy()});var t=$(this.shareInstance.copyElement);t.parent().on("mouseleave",function(t){var s=t.relatedTarget;e.args.$container.removeClass("copy_mouse_hover"),e.$dom.find($(s))||(e.mouseenterInFlash=!1)}),t.parent().on("mouseenter",function(){e.args.$container.addClass("copy_mouse_hover")})},_reinitialCopy:function(){this.$dom.find(".tbshare_copy .tbshare_title_box").removeClass("copy_done"),this.$dom.find(".tbshare_copy .tbshare_title_box").html("\u590d\u5236\u94fe\u63a5")},_setCopyCallback:function(){var e=this;e.shareInstance.tbcopy.setSuccessCallback(function(){e.$dom.find(".tbshare_copy .tbshare_title_box").addClass("copy_done"),e.$dom.find(".tbshare_copy .tbshare_title_box").html("\u5df2\u590d\u5236\u94fe\u63a5")})},show:function(){this.$dom.show()},hide:function(){this.$dom.hide()},showMore:function(e,t){return"undefined"!=typeof e&&"undefined"!=typeof t&&this.$moreWrapper.css({left:e,top:t}),this.$moreWrapper.show(),this.$moreWrapper},hideMore:function(){this.$moreWrapper.hide()},setShareContent:function(e){return this.shareInstance.setShareContent(e),this}}});_.Module.define({path:"tbui/widget/aside_float_bar",requires:["tbui/widget/tbshare_popup","tbui/widget/bubble_tip"],sub:{initial:function(t){"undefined"!=typeof PDC&&PDC.mark("c_afbavi"),this.options=t,this.$root=$('<ul class="tbui_aside_float_bar"></ul>');for(var e=0,i=t.buttons.length;i>e;e++){var a=t.buttons[e];this.addButton(a)}this.$root.appendTo("body");var o=this;o.relocate(),$(window).resize(function(){o.relocate()});var r=PageData.product||PageData.page;if("pb"==r&&this.$root.find(".tbui_fbar_favor").on("mouseenter",function(){$.stats.track("PB\u60ac\u6d6e\u7231\u901b\u7684\u5427","\u8d34\u5427PC\u9875\u9762\u4f18\u5316","pb","click"),$(this).find(".tbui_aside_favor_list a").one("click",function(){$.stats.track("PB\u60ac\u6d6e\u7231\u901b\u5427\u5c55\u5f00\u5427","\u8d34\u5427PC\u9875\u9762\u4f18\u5316","pb","click")})}),"frs"==r||"pb"==r||"pb_bright"==r){if("frs"==r){var n=["\u53d1\u5e16","\u5237\u65b0","\u5206\u4eab","\u7231\u901b\u7684\u8d34\u5427","\u53cd\u9988","\u8fd4\u56de\u9876\u90e8"];1===this.options.isBottle&&n.unshift("\u6f02\u6d41\u74f6"),n.unshift("\u4e0b\u8f7d\u4e8c\u7ef4\u7801")}else var n=["\u9b54\u6cd5\u9053\u5177","\u795e\u6765\u4e00\u53e5","\u5206\u4eab","\u7231\u901b\u7684\u8d34\u5427","\u53cd\u9988","\u53ec\u5524\u5ea6\u5a18","\u8fd4\u56de\u9876\u90e8"];r="pb"==r||"pb_bright"==r?"pb":"frs",this.$root.delegate(".tbui_aside_fbar_button","mouseenter",function(t){var e=$(t.target),i=e.parent().index();$.stats.track(n[i]+"\u70b9\u51fb\u91cf","FRS/PB\u53f3\u4fa7\u5de5\u5177\u680f\u7edf\u8ba1",r,"click")}),this.$root.delegate(".tbui_fbar_post","mousedown",function(){$.stats.track("frs\u53f3\u4fa7\u53d1\u5e16\u6309\u94ae\u70b9\u51fb\u91cf","\u65b0\u53d1\u8d34\u4f18\u5316\u7edf\u8ba1",r,"click")})}1===this.options.isBottle&&this.options.isNewBottle>0?$.stats.track("pb\u5927\u56fe\u5165\u53e3","pc\u6f02\u6d41\u74f6",r,"view"):1===this.options.isBottle&&0===this.options.isNewBottle&&$.stats.track("\u805a\u5408\u9875\u5165\u53e3","pc\u6f02\u6d41\u74f6",r,"view")},addButton:function(t){var e=$($.tb.format('<li class="tbui_aside_fbar_button tbui_fbar_#{btnName}"><a href="#"></a></li>',{btnName:t})),i=this["_"+t];i&&i.call(this,e)&&this.$root.append(e);var a=this;$("body").click(function(){a.hidePanel()})},hidePanel:function(){$("#bdshare_tb_l").hide(),$(".tbui_aside_smiley").hide(),$("#tbui_aside_favor_list").hide(),$(".tbui_aside_props_list").hide()},relocate:function(){$(window).width()<1105?this.$root.addClass("tbui_afb_compact"):this.$root.removeClass("tbui_afb_compact")},_square:function(t){return t.children().tbattr("href","/f?kw=%D0%E3"),t.children().tbattr("target","_blank"),!0},_bottle:function(t){var e=this,i=PageData.product||PageData.page;return this.bottleBubble(t),t.children().tbattr("javascript:;"),t.children().click(function(){$.stats.track("pb\u5927\u56fe\u5165\u53e3","pc\u6f02\u6d41\u74f6",i,"click"),location.href="/bottle/photopbPage?thread_id="+e.options.bottleTid}),!0},_nobottle:function(t){var e=PageData.product||PageData.page;return this.bottleBubble(t),t.children().tbattr("href","javascript:;"),t.children().click(function(){$.stats.track("\u805a\u5408\u9875\u5165\u53e3","pc\u6f02\u6d41\u74f6",e,"click"),location.href="/bottle/bottlesPage"}),!0},_top:function(t){var e=$(window);0==e.scrollTop()&&t.css("visibility","hidden"),t.click(function(t){function i(){o=Math.floor(o/2),window.scrollTo(0,o),o>2?a=setTimeout(i,40):(window.scrollTo(0,0),clearTimeout(a))}t.preventDefault();var a=null,o=e.scrollTop();$.browser.msie?window.scrollTo(0,0):i()});var i,a=!1;return e.bind("scroll",function(){i&&clearTimeout(i),i=setTimeout(function(){e.scrollTop()>0?0==a&&(t.css("visibility","visible"),a=!0):a&&(t.css("visibility","hidden"),a=!1)},500)}),!0},_refresh:function(t){return t.click(function(){return $.tb.location.reload(),!1}),!0},_post:function(t){var e=this;return e.options.dealTab&&$(".j_publish").length?t.children().tbattr("href",$(".j_publish").tbattr("href").replace(/&amp;/g,"&")).tbattr("target","_blank"):(t.children().tbattr("href","#sub"),t.click(function(t){t.preventDefault(),t.stopPropagation(),setTimeout(function(){e.fire("wanna_post")},50)})),!0},_share:function(t){return this.requireInstance("tbui/widget/tbshare_popup",[{$container:t.find("a")}]),!0},_radar:function(t){var e=this;return t.find("a").append('<img src="../../static/img/toolbar/radar.gif" class="tbui_radar_img" />'),t.find("a").tbattr({href:$.tb.unescapeHTML(e.options.radarData&&e.options.radarData.link),target:"_blank"}),t.on("mousedown","a",function(){$.stats.track("radar","radar_banner")}),$.browser.msie&&7==$.browser.version&&t.css("marginBottom","-4px"),$.browser.msie&&6==$.browser.version&&(t.append("<div></div>"),t.css("marginBottom","-3px")),!0},_tsukkomi:function(t){var e=this;$.browser.msie&&7==$.browser.version&&t.css("marginBottom","-4px"),$.browser.msie&&6==$.browser.version&&t.css("marginBottom","-3px").append("<div></div>");var i=$('<div class="tbui_aside_smiley"></div>');return t.append(i),_.Module.use("common/component/InterestSmiley",{container:i,smileClass:"t_smile_bg",type:"toolbar",scrollCss:{padding:"9px 0px 0px 0px"},scrollBarHide:function(){i.width(296)},scrollBarShow:function(){i.width(306)},dataPostor:e.options.dataPostor},function(a){e.interestSmile=a,e.interestSmile.generic(),t.on("mouseenter",function(){e.hidePanel()}),t.delayhover({enterDelay:300,leaveDelay:700,mouseenter:function(){i.fadeIn(),e.interestSmile.scrollPanel&&e.interestSmile.scrollPanel.setHeight(156)},mouseleave:function(){i.fadeOut()}}).children("a").click(function(t){t.preventDefault(),t.stopPropagation()})}),!0},_favor:function(t){var e="//web.archive.org/web/20201119054109/https://tb2.bdstatic.com/tb/img/loading2_a8a93d0.gif";if(0==PageData.user.is_login)return!1;var i=PageData.user.id,a="/p/getLikeForum",o=[];$.browser.msie&&6==$.browser.version&&(t.append("<div></div>"),t.css("marginBottom","-3px"));var r=$('<ul class="tbui_aside_favor_list clearfix" id="tbui_aside_favor_list"></ul>'),n='<li class="j_favor_loading"><div class="favor_loading"><img src="'+e+'">\u6b63\u5728\u52a0\u8f7d\uff0c\u8bf7\u7a0d\u540e\u3002\u3002\u3002</div></li>';r.append(n),$.ajax({url:a,dataType:"json",type:"GET",data:{uid:i}}).done(function(t){if(t&&0===t.errno){if(t.data&&t.data.info&&(o=t.data.info),0==o.length)return!1;if(o.length>0){var e,i=o,a=!1;i.length<=8?e=i.length:(e=7,a=!0),r.find(".j_favor_loading").hide();for(var n=0;e>n;n++){var s={kw:encodeURIComponent(i[n].forum_name),forumName:$.tb.subByte(i[n].forum_name,12)};r.append($.tb.format('<li><a href="//web.archive.org/web/20201119054109/https://tieba.baidu.com/f?ie=utf-8&kw=#{kw}" target="_blank" class="ui_text_summary">#{forumName}</a></li>',s))}a&&r.append('<li><a target="_blank" class="ui_text_desc" href="//web.archive.org/web/20201119054109/https://tieba.baidu.com/home/forum?id='+PageData.user.portrait+'" class="aside_float_favforum_more">\u66f4\u591a&gt;&gt;</a></li>')}}}),r.hide().appendTo(t);var s=this;return t.on("mouseenter",function(){s.hidePanel()}),t.delayhover({enterDelay:300,leaveDelay:700,mouseenter:function(){r.fadeIn()},mouseleave:function(){r.fadeOut()}}).children("a").click(function(t){t.preventDefault(),t.stopPropagation()}),!0},_feedback:function(t){return t.children().tbattr("target","_blank").tbattr("href","/pmc/feedback"),!0},_lab:function(t){t.children().tbattr("target","_blank").tbattr("href","//web.archive.org/web/20201119054109/https://tieba.baidu.com/idea/index");var e=$("<div class='tbui_aside_lab_tip'></div>");if(t.append(e),$.tb.Storage.remove("close_cm_bubble"),"1"!=$.tb.Storage.get("close_mt_bubble")&&+new Date<+new Date(2015,6,19)){var i={content:"<span class='red-text'>\u5feb\u6377\u952e\u8d34\u5427</span>\u4e0a\u7ebf\u5566\uff0c\u5feb\u6765\u4f53\u9a8c\u5427~",arrow_dir:"right",bubble_css:{top:0,right:50,width:150},wrap:e,closeBtn:!0},a=this.requireInstance("tbui/widget/bubble_tip",i);a.bind("onclose",function(){$.tb.Storage.set("close_mt_bubble","1",(new Date).getTime()+6048e5),a.closeBubble()}),a.j_bubble.show()}return!0},_home:function(t){return t.children().tbattr("href","//web.archive.org/web/20201119054109/https://www.baidu.com?tn=SE_hldp03460_124vf6k4"),t.children().addClass("j_aside_float_bar_go_home"),t.children().tbattr("target","_blank"),!0},_down:function(t){return t.on("mouseenter",function(){t.find("a").append('<img src="//web.archive.org/web/20201119054109/https://tb2.bdstatic.com/tb/img/frsQRCode_a343e52.png" class="tbui_pb_qr_code" />')}),t.on("mouseleave",function(){t.find(".tbui_pb_qr_code").remove()}),t.on("click","a",function(){$.stats.track("frs\u4e0b\u8f7d\u4e8c\u7ef4\u7801\u70b9\u51fb","FRS/PB\u53f3\u4fa7\u5de5\u5177\u680f\u7edf\u8ba1","pb","click"),location.href="//web.archive.org/web/20201119054109/https://tiebac.baidu.com/c/s/download/pc"}),!0},bottleBubble:function(t){var e="bottleBubble",i="1",a=30,o=['<div class="tbui_aside_bubble_wrapper">','<div class="tbui_aside_bubble_word">',"<h6>\u8fd9\u91cc\u662f\u6f02\u6d41\u74f6\uff0c\u8fdb\u53bb\u770b\u770b<h6>","</div></div>"].join(""),r=$(o);$.cookie(e)!==i&&($.cookie(e,i,a),r.appendTo(t),setTimeout(function(){$(".tbui_aside_bubble_wrapper").hide()},7e3)),$(".tbui_aside_bubble_wrapper").click(function(){t.children().click()})}}});_.Module.define({path:"frs-footer/widget/aside_float_btns",requires:["tbui/widget/aside_float_bar"],sub:{initial:function(t){this.options=t;var i;i=0===this.options.isBottle?"":1===this.options.isBottle&&0!==this.options.isNewBottle?"bottle":"nobottle",this.requireInstance("tbui/widget/aside_float_bar",[{buttons:["down",i,"post","refresh","share","favor","feedback","top"],bottleTid:this.options.bottleTid,isBottle:this.options.isBottle,isNewBottle:this.options.isNewBottle}])}}});_.Module.define({path:"ueglib/widget/verify_manager_phone",requires:[],sub:{_hasNextTimeButton:null,_template:{_confirmDialog:["<h2>","#{title}","</h2>","<p>","#{text}","</p>"].join(""),_changeBind:["<div>* \u5982\u60a8\u9700\u8981\u6362\u7ed1\u60a8\u7684\u624b\u673a\u540e\u518d\u8fdb\u884c\u7ed1\u5b9a\u9a8c\u8bc1\uff0c\u8bf7<a target='_blank' href='#{href}'>\u70b9\u6b64\u6362\u7ed1</a>\u3002</div>"].join(""),_complain:["<div>* \u5982\u679c\u60a8\u7533\u8bc9\u8fc7\u7a0b\u4e2d\u51fa\u73b0\u95ee\u9898\u5bfc\u81f4\u65e0\u6cd5\u9a8c\u8bc1\uff0c\u8bf7<a target='_blank' href='#{href}'>\u70b9\u6b64\u4e13\u8d34</a>\u53cd\u9988\u3002</div>"].join("")},_url:{nextTime:"/bawu2/checkphone/commitActsctrl",getPopPassData:"/bawu2/checkphone/getPhoneToken",verifyDone:"/bawu2/checkphone/commitCheckTime"},initial:function(t){var e=this;e._hasNextTimeButton=!t,e._title=null,e._text=null,t?(e._title="\u5c0a\u656c\u7684\u8d34\u5427\u5427\u4e3b\u7528\u6237",e._text="\u4e3a\u4e86\u60a8\u7684\u8d26\u53f7\u5b89\u5168\uff0c\u8bf7\u60a8\u8fdb\u884c\u624b\u673a\u7ed1\u5b9a\u9a8c\u8bc1\uff0c<br/>\u4ee5\u9632\u8d26\u53f7\u88ab\u76d7\u9020\u6210\u635f\u5931\u3002<span class='verify_manager_phone_tip_strong'>\uff08\u8bbe\u7f6e\u6210\u529f\u540e\u4e0d\u518d\u63d0\u793a\uff09</span>"):(e._title="\u5c0a\u656c\u7684\u8d34\u5427\u5427\u4e3b\u7528\u6237\uff1a",e._text="\u4e3a\u4e86\u60a8\u7684\u8d26\u53f7\u5b89\u5168\uff0c\u5f3a\u70c8\u5efa\u8bae\u60a8\u8fdb\u884c\u624b\u673a\u7ed1\u5b9a\u9a8c\u8bc1\uff0c<br/>\u4ee5\u9632\u8d26\u53f7\u88ab\u76d7\u9020\u6210\u635f\u5931\u3002<span class='verify_manager_phone_tip_strong'>\uff08\u8bbe\u7f6e\u6210\u529f\u540e\u4e0d\u518d\u63d0\u793a\uff09</span>"),e._popConfirmDialog()},_startVerify:function(){var t=this;t._getPopPassData(function(e){t._popPassDialog(e.hasBind?"verify":"bind",e.token)},function(){t._onVerifyFail()})},_onVerifyFail:function(t){var e=this;t||(t="\u9a8c\u8bc1\u5931\u8d25~ T_T \u8bf7\u91cd\u8bd5~~");var n={message:"<h2>\u9a8c\u8bc1\u624b\u673a\u5931\u8d25\uff1a</h2><p>"+t+"</p>",holderClassName:"verify_manager_phone_dialog",buttons:[{text:"\u91cd\u8bd5",callback:function(){e._startVerify()}},{text:"\u53d6\u6d88"}]};n.buttons[0]["class"]="btn_default btn_left",n.buttons[1]["class"]="btn_sub",$.tb.alert(n)},_popConfirmDialog:function(){function t(){n._startVerify()}function e(){n._informServerNextTime()}var n=this,a={text:"\u4e0b\u6b21\u518d\u8bf4",callback:e};a["class"]="btn_sub";var i={text:"\u7acb\u5373\u8bbe\u7f6e",callback:t};i["class"]="btn_default btn_left";var o=[i];n._hasNextTimeButton&&o.push(a),$.tb.alert({message:$.tb.format(n._template._confirmDialog,{title:n._title,text:n._text}),holderClassName:"verify_manager_phone_dialog",buttons:o})},_getPopPassData:function(t,e){var n=this;$.ajax({url:n._url.getPopPassData,dataType:"json",success:function(n){n&&0===n.errno?t(n.data):e()},error:e})},_popPassDialog:function(t,e){function n(t){o._informServerVerifyDone(t)}function a(){o._informServerVerifyDone()}function i(){o._onVerifyFail()}var o=this;"verify"===t?o._showMobileVerify(e,a,i):o._showMobileBind(e,n,i)},_showMobileVerify:function(t,e,n){var a=this;$.JsLoadManager.use(["https://web.archive.org/web/20201119054109/https://passport.baidu.com/passApi/js/uni_forceverify_wrapper.js?cdnversion="+a._getTimeStamp(),"https://web.archive.org/web/20201119054109/https://passport.bdimg.com/passApi/js/wrapper.js?cdnversion="+a._getTimeStamp()],function(){var i=window.passport.pop.initForceverify({token:t,curType:"mobile",onRender:function(){var t=this,e=$(t.getById("content")),n=e.find(".footer-tip");a._updatePassDialogZIndex(t);var i=$($.tb.format(a._template._changeBind,{href:"//web.archive.org/web/20201119054109/https://passport.baidu.com/v2/accountsecurity?act=rebindmobile"}));n.prepend(i);var o=$($.tb.format(a._template._complain,{href:"//web.archive.org/web/20201119054109/https://tieba.baidu.com/p/3472422906"}));n.prepend(o);var r=n&&n.html?n.html()||"":"",s=r.lastIndexOf("<br>");n.html(r.substring(0,s))},onSubmitSuccess:e,onGetapiError:n,onSubmitFailure:n});i.show()},!0,"utf-8")},_showMobileBind:function(t,e,n){var a=this;$.JsLoadManager.use(["https://web.archive.org/web/20201119054109/https://passport.baidu.com/passApi/js/uni_armorwidget_wrapper.js?cdnversion="+a._getTimeStamp(),"https://web.archive.org/web/20201119054109/https://passport.bdimg.com/passApi/js/wrapper.js?cdnversion="+a._getTimeStamp()],function(){var i=window.passport.pop.ArmorWidget("bindmobile",{token:t,onRender:function(){var t=this,e=$(t.getById("content")),n=e.find(".footer-tip");a._updatePassDialogZIndex(this);var i=$($.tb.format(a._template._complain,{href:"//web.archive.org/web/20201119054109/https://tieba.baidu.com/p/3472422906"}));n.prepend(i);var o=n&&n.html?n.html()||"":"",r=o.lastIndexOf("<br>");n.html(o.substring(0,r))},successCountdown:0,onSubmitSuccess:function(t){e(t.bindid)},onInitFail:n,otherValue:{tpl:"tb"}});i.show()},!0,"utf-8")},_informServerNextTime:function(){var t=this;$.ajax(t._url.nextTime)},_informServerVerifyDone:function(t){var e=this,n=function(){$.tb.alert({message:"<h2>\u8bbe\u7f6e\u6210\u529f\uff01</h2>",holderClassName:"verify_manager_phone_dialog",onclose:function(){location.reload()},buttons:[{text:"\u786e\u8ba4"}]})},a=function(){e._onVerifyFail()},i=e._url.verifyDone;t&&(i+="?bindid="+t),$.ajax({url:i,dataType:"json",success:function(t){t&&0===t.errno?n():a()},error:a})},_getTimeStamp:function(){var t=(new Date).getTime();return Math.floor(t/6e4)},_updatePassDialogZIndex:function(t){var e=$(t.getById("mask")),n=$(t.getById("wrapper"));e.css("zIndex",5e4+parseInt(e.css("zIndex"))),n.css("zIndex",5e4+parseInt(n.css("zIndex")))}}});_.Module.define({path:"ueglib/widget/inform_manager_verify_phone",requires:["ueglib/widget/verify_manager_phone"],sub:{initial:function(e,i,n){var o=this;o._forceMode=n,e&&(i?o._commitRemindTime(function(){o._informManager()},null):o._informManager())},_commitRemindTime:function(e,i){$.ajax({url:"/bawu2/checkphone/commitRemindTime",dataType:"json",success:function(n){0===n.errno?"function"==typeof e&&e():"function"==typeof i&&i()},error:i})},_informManager:function(){var e=this;this.requireInstance("ueglib/widget/verify_manager_phone",[e._forceMode])}}});!function(){var e=!1;_.Module.define({path:"ueglib/widget/detect_manager_block",requires:["ueglib/widget/verify_manager_phone"],sub:{initial:function(){},setBlockState:function(n){e=n},getBlockState:function(){return e},doOnNotBlocked:function(n,t){void 0===t&&(t=!0),e?t&&this.requireInstance("ueglib/widget/verify_manager_phone",[!0]):n()},doOnBlocked:function(n){e&&n()}}})}();_.Module.define({path:"bawu/widget/bawuAddSection",sub:{initial:function(o){window.onload=function(){var i=!1;$(".dialogJmodal").each(function(){"none"!=$(this).css("display")&&(i=!0)}),($(".dialogJmodal").length<1||!i)&&$.ajax({url:"/bawu2/platform/checkTabRemind",type:"get",async:!0,data:{word:o.fname,tbs:o.tbs,ie:"utf-8"},dataType:"json",success:function(i){if(0===+i.errno&&i.data){var n='<div class="inform-section-dialog" id="inform_section-dialog"><div class="inform-section-title-wrap"><span class="inform-section-closeBtn"></span></div><div class="inform-section-content-wrap"><h4>\u7248\u5757\u5206\u533a\u529f\u80fd\u4e0a\u7ebf\u5566</h4><p>\u7248\u5757\u662f\u5427\u5185\u65b0\u589e\u7684\u7279\u8272\u5206\u7c7b\uff0c\u53ef\u4ee5\u901a\u8fc7\u7248\u5757\u5feb\u901f\u627e\u5230\u4f60\u611f\u5174\u8da3\u7684\u5185\u5bb9\u5206\u7c7b\u3002\u53d1\u5e16\u65f6\u9009\u62e9\u5bf9\u5e94\u7248\u5757\uff0c\u80fd\u8ba9\u4f60\u7684\u5185\u5bb9\u540c\u6b65\u663e\u793a\u5728\u7248\u5757\u5185\uff0c\u8ba9\u66f4\u591a\u611f\u5174\u8da3\u5427\u53cb\u770b\u5230\u3002<br>\u5427\u52a1\u53ef\u5728\u7535\u8111\u7aef\u8bbe\u7f6e\u7248\u5757\uff0c\u5427\u52a1\u4e2d\u5fc3-\u672c\u5427\u8bbe\u7f6e-\u7248\u5757\u5206\u533a\u7ba1\u7406</p><button class="inform-section-set">\u7acb\u5373\u8bbe\u7f6e</button></div></div>',t=new $.dialog({html:$.tb.format(n),title:"\u8bbe\u7f6e\u7248\u5757\u5206\u533a",draggable:!1,width:450,height:285,show:!0,holderClassName:"sectionDialog"});$(".sectionDialog").removeClass("dialogJshadow"),$(".inform-section-closeBtn").on("click",function(){t.close()}),$(".inform-section-set").on("click",function(){window.location.href="/bawu2/platform/listTools?word="+o.fname_u})}}})}}}});_.Module.define({path:"user/widget/icon_tip",requires:["tbui/widget/card"],sub:{_icon_tip:null,_icon_tip_ajax:null,_dialog:null,_iconData:{},_option:{width:300},initial:function(i){this.pageType=i.pageType,this.myIcons=i.myIcons,this.bindEvents(i.pagelet)},bindEvents:function(i){var t=this,n=$("body");n.on("mouseenter.icon_tip",".j_icon_slot",function(){t._icon_tip&&t._icon_tip.closeCard(),t.buildCard($(this))}).on("mouseleave.icon_tip",".j_icon_slot",function(){t._icon_tip&&t._icon_tip.closeCard({type:"delayClose",time:200}),t._icon_tip=null}),n.on("click.icon_tip_buy",".j_buy_icon_btn",function(i){i.preventDefault(),t.getOneIcon(t._iconData)}).on("click.icon_tip_manage",".j_manage_icon_btn",function(i){i.preventDefault(),t.jumpToIhome()}),i.on("destroy",function(){n.off("mouseenter.icon_tip").off("mouseleave.icon_tip").off("click.icon_tip_buy").off("click.icon_tip_manage")})},buildCard:function(i){var t=this;t._icon_tip&&(t._icon_tip.closeCard(),t._icon_tip=null);var n=i.getData();this._iconData=n;var e,o,a,c,r,l,_=_||1,s=50,p="//web.archive.org/web/20201119054109/https://tb1.bdstatic.com/tb/cms/com/icon/";if(n.sprite){if(e=n.sprite[n.value],!e)for(var u in n.sprite)if(n.sprite[u]&&(0!=n.value||"meizhi_level"==n.name)){e=n.sprite[u];break}o=e.split(","),a=o[0],c=o[1],l=p+n.category_id+"_36.png?stamp="+a,r='style="background: url('+l+") no-repeat -"+c*s+"px  -"+(_-1)*s+'px;"'}else r=i.css("background");var d=this.getIconTipHtml(n);if(!d)return!1;null==n.title&&(n.title=i.tbattr("title"));var f=['<div class="icon_tip_wrapper">','<div class="icon_tip_img" '+r+" />",'<div class="icon_tip_info">','<div class="icon_tip_title">'+n.title+(d.expired?d.expired:"")+"</div>",'<div class="icon_tip_intro">'+d.intro+"</div>",'<div class="icon_tip_btns">',d.btn,"</div>","</div>","</div>"].join(""),g={content:f,card_css:{width:t._option.width,zIndex:$.getcurzIndex()},auto_positon:!0,event_target:i,attr:"id='icon_tip'",wrap:$("body")};t._icon_tip=t.requireInstance("tbui/widget/card",g),t._icon_tip.showCard({type:"delayShow",time:200})},getOneIcon:function(i){var t=this,n=i.name;if(n){var e=$.dialog.confirm("\u786e\u5b9a\u8d2d\u4e70\u3010"+i.title+"\u3011\u5370\u8bb0\u561b\uff1f\u5c06\u6d88\u8017\u60a8"+i.price+"T\u8c46",{title:"\u8d2d\u4e70\u5370\u8bb0\u63d0\u793a",acceptValue:"\u786e\u5b9a",cancelValue:"\u53d6\u6d88"});e.bind("onaccept",function(i){i.stopImmediatePropagation();var e={ie:"utf-8"};e.tbs=PageData.tbs,e.icon_name=n,e.level=1,t._icon_tip_ajax&&t._icon_tip_ajax.abort(),t._icon_tip_ajax=$.ajax({type:"post",url:"/icon/buyIcon",data:e,dataType:"json"}).success(function(i){if(i&&0===i.no){var n=i.data;return n.icon_info?(t.showDialog("\u8d2d\u4e70\u6210\u529f"),void $.tb.location.reload()):void t.showDialog("\u8d2d\u4e70\u51fa\u9519\uff0c\u8bf7\u67e5\u770b\u8d2d\u4e70\u8bb0\u5f55\u786e\u8ba4\u662f\u5426\u8d2d\u4e70\u6210\u529f")}t.showDialog(i&&2270028===i.no?"T\u8c46\u4e0d\u8db3":"\u8d2d\u4e70\u51fa\u9519\uff0c\u6ca1\u6709\u8d2d\u4e70\u6210\u529f")})}).bind("oncancel",function(){})}},getIconTipHtml:function(i){if(null==i.intro||null==i.intro_url)return!1;if(this.whetherIHaveTheIcon(i,this.myIcons))return{intro:"<p>"+i.intro+' <a target="_blank" href="'+i.intro_url+'">\u8be6\u60c5\u300b</a></p>',btn:'<a class="btn_default btn_small j_manage_icon_btn " href="" target="_blank" >\u7ba1\u7406\u5370\u8bb0</a>'};if(null!=i.price&&0!=i.price){var t='<p>\u4ef7\u683c:<i class="icon_tbean" style="vertical-align:middle;"></i><span class="orange_text " >'+i.price+'</span> <a target="_blank" href="'+i.intro_url+'">\u8be6\u60c5\u300b</a></p>';return{intro:t,btn:'<a class="btn_default btn_small j_buy_icon_btn"  >\u8d2d\u4e70\u5370\u8bb0</a>'}}return{intro:"<p>"+i.intro+' <a target="_blank" href="'+i.intro_url+'">\u8be6\u60c5\u300b</a></p>',btn:'<a class="btn_default btn_small" target="_blank" href="'+i.intro_url+'" >\u83b7\u53d6\u5370\u8bb0</a>'}},jumpToIhome:function(){var i=$(".userinfo_honor"),t=i.find(".j_icon_slot");$.tb.location.getHref().match("/home/")&&i&&t?t.first().trigger("click"):window.open("/home/main?id="+PageData.user.portrait+"&fr=icon_tip#manage_icon")},whetherIHaveTheIcon:function(i,t){var n,e;for(e in t)if(n=t[e],i.name==n)return!0;return!1},showDialog:function(i){this._dialog&&this._dialog.close(),this._dialog=null,this._dialog=new $.dialog({title:"\u5370\u8bb0\u63d0\u793a",html:i})},formateDate:function(i){var t=new Date(1e3*parseInt(i));return t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()}}});_.Module.define({path:"encourage-base/widget/firework_v2",requires:["common/widget/ScrollPanel","tbui/widget/login_dialog","tbui/widget/captcha_dialog","encourage-payment/widget/tdou_view_pay","common/widget/LoginDialog"],sub:{getFireworkUrl:"//web.archive.org/web/20201119054109/https://tbmsg.baidu.com/fires/",buyFireworkUrl:"/fireworks/buyFire",registerFireworkUrl:"/fireworks/registerFire",getFireworkListUrl:"//web.archive.org/web/20201119054109/https://tbmsg.baidu.com/fire?ranklist",getTdouUrl:"/fireworks/getMyGetTdou",getFireworkCount:"/fireworks/getCount",likeForumUrl:"/f/like/commit/add",getAttendedNumUrl:"/fireworks/getMemberNum",presentFirework:null,user:PageData.user,fireworkList:[],errorMap:{2140003:"\u70df\u82b1\u4f7f\u7528\u4eba\u6570\u8fc7\u591a\uff0c\u6682\u65f6\u4e0d\u80fd\u8d2d\u4e70\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5...",2270009:"\u60a8\u7684T\u8c46\u4e0d\u8db3..."},lastUpdateTime:0,isActive:!1,isStop:!1,isPlayingSwf:!1,RegisterPkId:null,countdownModule:null,noticeModule:null,listModule:null,jsonpRetryTime:0,initial:function(t){var i=this;i.$btn=$(".j-firework-sender"),i.$root=$(".firework-wrap2"),t.fireworks&&t.fireworks.list&&(i.fireworkList=t.fireworks.list),i.countdownModule=new i.CountdownModule(i.$root,i),i.noticeModule=new i.NoticeModule(i.$root),i.listModule=new i.ListModule(i.$root),i.flashModule=new i.FlashModule(i.$root,i,"firework-swf","firework-flash"),i.bindEvent(),i.startFirework(),i.preLoadResource(),window.jsonpGetFireworkList=function(t){return function(i){t.getFireworkList(i)}}(this),window.jsonpGetFirework=function(t){return function(i){t.getFirework(i)}}(this)},CountdownModule:function(t,i){var e=this,o=baidu.template;e.core=i,e.$dom=t.find(".firework-countdown"),e.$root=t,e.timer=null,e.countdownTpl='<!-- \u70df\u82b1\u5012\u8ba1\u65f6\u6a21\u5757\u6a21\u677f -->     <a href="#" class="close-btn j-countdown-close-btn"></a>     <p class="firework-countdown-notice">         <% if (data.is_Vip == 2) { %>         <span class="vip-icon"><i class="icon-vip2-16"></i></span>         <% } else if (data.is_Vip == 1) { %>         <span class="vip-icon"><i class="icon-vip1-16"></i></span>         <% } %>         <span class="<%= data.is_Vip == 0 ? \'blue-text\' : \'vip-red\' %>"><%= data.user_name %></span>\u7684\u70df\u82b1\u5373\u5c06\u71c3\u653e     </p>     <div class="countdown-middle">         <div class="firework-countdownding countdown-bar">             <span class="j-countdown-min-1 countdown-min-1">9</span>             <span class="j-countdown-min-2 countdown-min-2">9</span>             <span class="j-countdown-sec-1 countdown-second-1">9</span>             <span class="j-countdown-sec-2 countdown-second-2">9</span>         </div>         <div class="firework-countdowned countdown-result">         </div>     </div>     <div class="countdown-footer">         <div class="firework-countdowning firework-detail">             <img class="image-radius" src="<%= data.fire_pic %>">             <div class="firework-detail-info">                 <p class="blue-text"><%= data.fire_name %></p>                 <p>\u603b\u4ef7\uff1a<i class="icon-tbean"></i> <span class="orange-text"><%= data.package_all_tdou %></span></p>                 <p>\u4efd\u6570\uff1a<span class="orange-text"><%= data.giftpkg_bonus_num %></span><span class="gray-text">\u4efd</span></p>             </div>         </div>         <div class="firework-countdowned firework-result-list">         </div>     </div>     <% if (attend != null) {%>         <button class="firework-countdowning btn-encourage j-attend-btn attend-btn" disabled>\u5df2\u6709<%= attend %>\u4eba\u53c2\u4e0e\u62a2T\u8c46</button>     <% } else {%>         <% if (data.is_focus === \'1\') { %>             <button class="firework-countdowning btn-encourage j-attend-btn attend-btn">\u5173\u6ce8\u672c\u5427\u62a2\u793c\u5305</button>         <% } else { %>             <button class="firework-countdowning btn-encourage j-attend-btn attend-btn">\u6211\u8981\u62a2\u793c\u5305</button>         <% } %>     <% } %>',e.visable=!1,e.pollinging=!1,e.firstPoll=!1,e.render=function(t){var i,e,a=this;a.pollinging=!1,e=$.tb.Storage.get("fireworks_"+a.core.user.id+"_"+t.package_id),e&&(a.core.isRegister=!0),a.firework=t,i=o(a.countdownTpl,{attend:e,data:t}),a.$dom.html(i),(+a.firework.user_id===+PageData.user.id||e)&&(a.$dom.find(".j-attend-btn").attr("disabled",!0),a.firstPoll=!0,a.startPolling()),a.visable||a.show(),a.startCountdown()},this.show=function(t){this.$dom.show(),this.$dom.animate({opacity:1},500,t),this.visable=!0},this.hide=function(t){var i=this;this.$dom.animate({opacity:0},500,function(){i.$dom.hide(),t()}),this.visable=!1,this.pollinging=!1},this.startCountdown=function(){var t=this;t.countdown=this.countdownFun(),t.countdown()},this.countdownFun=function(){var t=this,i=this.$root.find(".countdown-bar"),e=this.$root.find(".j-countdown-min-1"),o=this.$root.find(".j-countdown-min-2"),a=this.$root.find(".j-countdown-sec-1"),s=this.$root.find(".j-countdown-sec-2"),n=t.firework.fire_end_time;return function(r){var l,d={min1:0,min2:0,sec1:0,sec2:0};if(l=Math.floor(n-+new Date/1e3),d.min1=Math.floor(l/600),d.min2=Math.floor(l/60)%10,d.sec1=Math.floor(l%60/10),d.sec2=l%60%10,l>=0&&(r?(d.min1!==r.min1&&e.html(d.min1),d.min2!==r.min2&&o.html(d.min2),d.sec1!==r.sec1&&a.html(d.sec1),d.sec2!==r.sec2&&s.html(d.sec2)):(e.html(d.min1),o.html(d.min2),a.html(d.sec1),s.html(d.sec2))),t.timer=setTimeout(function(){t.countdown(d)},1e3),t.pollinging&&(l%3===0||t.firstPoll===!0)){t.firstPoll=!1;var c={};c.package_id=t.firework.package_id,$.get(t.core.getAttendedNumUrl,c,function(i){t.$root.find(".j-attend-btn").html("\u5df2\u6709"+i.data+"\u4eba\u53c2\u4e0e\u62a2T\u8c46")})}3>=l&&(i.addClass("red-text"),t.$root.find(".j-attend-btn").attr("disabled",!0),t.sendMessage(l))}},this.sendMessage=function(t){var i=this,e={};e.package_id=i.firework.package_id,e.user_name=PageData.user.name,e.tbs=PageData.tbs,i.core.isRegister&&(2===t&&i.core.user.id%3===0&&$.get(i.core.getTdouUrl,e,function(t){i.core.noticeModule.resultData=0!==t.no?0:t.data}),1===t&&i.core.user.id%3===1&&$.get(i.core.getTdouUrl,e,function(t){i.core.noticeModule.resultData=0!==t.no?0:t.data}),0===t&&i.core.user.id%3===2&&$.get(i.core.getTdouUrl,e,function(t){i.core.noticeModule.resultData=0!==t.no?0:t.data})),1===t&&i.core.user.id%2===0&&i.getRankList(),2===t&&i.core.user.id%2===1&&i.getRankList(),-2>t&&(i.getRankList(),i.core.isRegister&&$.get(i.core.getTdouUrl,e,function(t){i.core.noticeModule.resultData=0!==t.no?0:t.data})),0>=t&&(clearTimeout(this.timer),this.timer=null,this.countdownFinish())},this.startPolling=function(){var t=this;t.pollinging=!0},this.countdownFinish=function(){e=this,e.core.flashModule.setUrl(e.firework.fire_animatic,e.firework.fire_animatic_time),e.core.countdownFinished()},this.sleep=function(t){var i=this;i.hide(function(){i.core.noticeModule.load(t)})},this.getRankList=function(){var t=this;t.core.jsonpRetryTime=3,$.getScript(t.core.getFireworkListUrl+"="+t.firework.package_id)}},NoticeModule:function(t){this.$root=t,this.$dom=t.find(".firework-notice"),this.timer=null,this.fireworkNoticeTpl='<!-- \u70df\u82b1\u62a2\u793c\u5305\u7ed3\u679c\u516c\u793a\u6a21\u5757\u6a21\u677f --> <p class="firework-countdown-notice">     <% if (firework.is_Vip == 2) { %>     <span class="vip-icon"><i class="icon-vip2-16"></i></span>     <% } else if (firework.is_Vip == 1) { %>     <span class="vip-icon"><i class="icon-vip1-16"></i></span>     <% } %>     <span class="<%= firework.is_Vip?\'vip-red\': \'blue-text\' %>"><%= firework.user_name %></span>\u7684\u70df\u82b1\u5df2\u71c3\u653e </p> <div class="notice-middle">     <div class="notice-result">         <% if (!attended) { %>             <% if (isOwner) { %>                 <p class="orange-text j-coutndown-result">\u60a8\u7684\u70df\u82b1\u5df2\u7ecf\u71c3\u653e</p>             <% } else { %>                 <p class="orange-text j-coutndown-result">\u624b\u592a\u6162\uff0c\u6ca1\u6709\u53c2\u4e0e\u62a2\u793c\u5305</p>             <% } %>         <% } else { %>             <% if (resultData > 0) { %>                 <p class="orange-text j-coutndown-result">\u606d\u559c\u60a8\uff0c\u62a2\u5230\u4e86<i class="icon-tbean"></i><%= resultData %></p>                 <% if (firework.fire_url && firework.describe) {%>                     <p class="fire-describe"><a href="<%= firework.fire_url %>" target="_blank"><%= firework.describe %></a></p>                 <% } %>             <% } else { %>                 <p class="orange-text j-coutndown-result">\u5f88\u9057\u61be\uff0c\u5565\u90fd\u6ca1\u62a2\u5230...</p>             <% } %>         <% } %>     </div> </div> <div class="notice-footer">     <div class="firework-result-list">         <% for (var i = 0; i < list.length; i++) { %>             <p>                 <span class="userName"><%= list[i].user_name %></span>                 <span class="tdouNum orange-text"><i class="icon-tbean"></i><%= list[i].money %></span>             </p>         <% } %>     </div> </div> ',this.visable=!1,this.attended=!1,this.resultData=null,this.listData=null,this.load=function(t){this.render(t),this.startScroll(),this.delayHide(),this.listData=null,this.resultData=null},this.render=function(t){var i=baidu.template,e=+PageData.user.id===+t.user_id;this.listLength=this.listData.length;var o=i(this.fireworkNoticeTpl,{list:this.listData,resultData:this.resultData,firework:t,attended:this.attended,isOwner:e});this.$dom.html(o),this.visable||this.show()},this.scroll=function(t){var i=this,e=24*(t-5),o=i.$dom.find(".firework-result-list");o.animate({top:-e},1e4,function(){})},this.delayHide=function(){var t=this;setTimeout(function(){t.hide()},6e4)},this.show=function(){this.$dom.show(),this.$dom.animate({opacity:1},500),this.visable=!0},this.hide=function(){var t=this;this.$dom.animate({opacity:0},500,function(){t.$dom.hide()}),this.visable=!1},this.startScroll=function(){var t=this;t.scroll(t.listData.length)}},ListModule:function(t){this.$root=t,this.$dom=t.find(".firework-list"),this.fireworkListTpl='<!-- \u70df\u82b1\u961f\u5217\u6a21\u5757\u6a21\u677f --> <div class="firework-list-wrap"> <% for (var i = 0; i < list.length && i < displayNum; i++) { %>     <p>         <label class="yellow-text"><%= i+2 %></label>         <% if (list[i].is_Vip == 2) {%>             <span class="vip-icon"><i class="icon-vip2-16"></i></span>         <% } else if(list[i].is_Vip == 1) { %>             <span  class="vip-icon"><i class="icon-vip1-16"></i></span>         <% } %>         <span class="<%= list[i].is_Vip? \'vip-red\' : \'blue-text\' %>"><%= list[i].user_name %></span>\u7684\u70df\u82b1\u5373\u5c06\u71c3\u653e     </p> <% } %> </div> <% if (list.length > displayNum) {%>     <div class="firework-list-footer">         <p>\u540e\u9762\u8fd8\u6709<span class="orange-text"><%= list.length - displayNum %></span>\u4e2a\u70df\u82b1\u5373\u5c06\u71c3\u653e</p>     </div> <% } %> ',this.visable=!1,this.render=function(t){var i,e=baidu.template;t.length>0?(i=e(this.fireworkListTpl,{list:t,displayNum:5}),this.$dom.html(i),this.visable||this.show()):this.visable&&this.hide()},this.show=function(){this.$dom.show(),this.visable=!0,this.$dom.animate({opacity:1},500)},this.hide=function(){var t=this;t.visable=!1,t.$dom.animate({opacity:0},500,function(){t.$dom.hide()})}},FlashModule:function(t,i){this.$root=t,this.core=i,this.$dom=t.find(".firework-flash"),this.visable=!1,this.hide=function(){},this.show=function(){},this.setUrl=function(){}},bindEvent:function(){var t,i=this,e={},o=[];i.observe("firework.add_firework",function(e,a){t=0,o=JSON.parse(a),$.map(o,function(e){i.lastUpdateTime<e.msg_body.fire_update_time&&e.msg_body.fire_end_time>+new Date/1e3&&(i.fireworkList.push(e.msg_body),t=e.msg_body.fire_update_time)}),i.lastUpdateTime=t,i.isActive&&!i.isStop?i.listModule.render(i.fireworkList):i.isActive||i.isStop||i.startFirework()}),i.observe("buy.firework",function(){i.showFireworkDialog()}),i.$root.on("click",".j-attend-btn",function(){PageData.user.is_login?(e.location_id=PageData.thread&&PageData.thread.thread_id||PageData.forum.id,e.location_type="frs"===PageData.page?0:1,e.package_id=i.presentFirework.package_id,e.forum_name=PageData.forum.name,e.user_name=i.user.name,e.tbs=PageData.tbs,e.ie="utf-8",$.post(i.registerFireworkUrl,e,function(t){0===t.no?($.tb.Storage.set("fireworks_"+i.user.id+"_"+e.package_id,t.data),i.isRegister=!0,i.$root.find(".j-attend-btn").html("\u5df2\u6709"+t.data+"\u4eba\u53c2\u4e0e\u62a2T\u8c46"),i.$root.find(".j-attend-btn").attr("disabled",!0),i.countdownModule.startPolling(),"1"===i.presentFirework.is_focus?(i.likeForum(),i.showErrorDialog("getTdou_focus")):i.showErrorDialog("getTdou")):i.showErrorDialog("error",t.no)})):i.requireInstance("common/widget/LoginDialog")}),this.$btn.on("click",function(){return PageData.user.is_login?i.showFireworkDialog():i.requireInstance("common/widget/LoginDialog"),!1}),this.$root.find(".firework-countdown").on("click",".j-countdown-close-btn",function(t){t.preventDefault(),i.stopFirework()}),this.$root.find(".firework-flash").on("click",".j-flash-close-btn",function(t){t.preventDefault(),i.flashModule.hide()})},startFirework:function(){var t=this;if(0!==t.fireworkList.length){for(t.lastUpdateTime=t.fireworkList[t.fireworkList.length-1].fire_update_time,t.isActive=!0,t.presentFirework=t.fireworkList.shift();!(t.presentFirework&&t.presentFirework.fire_end_time>+new Date/1e3+5);){if(0===t.fireworkList.length)return t.isActive=!1,void 0;t.presentFirework=t.fireworkList.shift()}t.renderFirework()}else t.isActive=!1},renderFirework:function(){var t=this;t.countdownModule.render(t.presentFirework),t.listModule.render(t.fireworkList)},showFireworkDialog:function(){var t,i,e,o,a=this,s=baidu.template,n='<!-- \u70df\u82b1\u8d2d\u4e70\u6d6e\u5c42\u6392\u884c\u699c\u6a21\u677f --> <a href="#" class="close-btn j-close-btn"></a> <div class="firework-good-list"> </div> <button class="btn-sub j-preview-btn preview-btn">\u9884\u89c8</button> <button class="btn-encourage j-buy-btn buy-btn">\u653e\u70df\u82b1</button> <div class="firework-rank">     <% if (rankData.length != 0) {%>     <table>,         <tr>             <td width="40">\u6392\u540d</td>             <td width="120">\u6635\u79f0</td>             <td width="30">\u6b21\u6570</td>         </tr>         <% for (var i = 0; i < rankData.length; i++) { %>             <tr>                 <td class="<%= i <= 2 ? \'yellow-text\' : \'\'%>"><%=i + 1%></td>                 <td>                     <a href="/home/main?un=<%=rankData[i][\'user_name\']%>&ie=utf-8" target="_blank">                         <span><%=rankData[i]["user_name"]%></span>                     </a>                 </td>                 <td align="center" class="orange-text"><%=rankData[i]["win"]%></td>             </tr>         <% } %>     </table>     <% } else { %>         <p class=\'firework-rank-empty\'>\u865a\u4f4d\u4ee5\u5f85...</p>     <% } %> </div> ',r='<!-- \u70df\u82b1\u8d2d\u4e70\u6d6e\u5c42\u70df\u82b1\u5217\u8868\u6a21\u677f --> <% var j = 0 ;%> <% for (var i in listData) { %>     <% j++ ;%>     <div class="firework-good" data-index="<%= i %>">         <div class="firework-image">             <img src="<%= listData[i].fire_pic %>">             <a class="corner-mark"></a>             <div class="name-bar"><p><%= listData[i].fire_name %></p></div>             <div class="hover-info">                 <p>\u5168\u5427\u53ef\u89c1\u805a\u62e2\u4eba\u6c14</p>                 <p>\u793c\u5305\u989d\u5ea6\uff1a<span class="orange-text"><%= listData[i].firepkg_all_tdou %></span><i class="icon-tbean"></i></p>                 <p>\u793c\u5305\u4efd\u6570\uff1a<span class="orange-text"><%= listData[i].giftpkg_bonus_num %></span>\u4efd</p>                 <p><span class="orange-text"><%= listData[i].fire_msg_time %></span>\u6b21\u5168\u5427\u901a\u544a</p>                 <% if (listData[i].is_focus == \'1\') { %>                 <p>\u81ea\u52a8\u5173\u6ce8\u672c\u5427</p>                 <% } else { %>                 <p>\u5f15\u5bfc\u5173\u6ce8\u672c\u5427</p>                 <% } %>             </div>         </div>         <div class="good-price">             <i class="icon-tbean"></i>             <span class="orange-text"><%= listData[i].fire_price %></span>         </div>     </div> <% } %> <% for (;j < 4; j++) { %>     <div class="firework-good-coming">         <div class="firework-image">             <img src="<%= comingGoodImg %>">             <a class="corner-mark"></a>             <div class="name-bar"><p>\u656c\u8bf7\u671f\u5f85</p></div>         </div>         <div class="good-price">             <i class="icon-tbean"></i>             <span class="orange-text">0</span>         </div>     </div>   <% } %>';if(!a.goodData||!a.rankData)return $.getScript(a.getFireworkUrl).fail(function(){$.getScript(a.getFireworkUrl)}),$.get("/minigame/rank/getRank",{t:(new Date).getTime()},function(t){0===t.no&&(a.rankData=t.data.fireworks,a.goodData&&a.showFireworkDialog())}),void 0;if(t=s(n,{rankData:a.rankData}),a.goodData.list)for(var l in a.goodData.list)a.goodData.list.hasOwnProperty(l)&&(a.goodData.list[l].fire_pic=a.goodData.list[l].fire_pic.replace(/^http:/,""));i=s(r,{listData:a.goodData.list,comingGoodImg:"//web.archive.org/web/20201119054109/https://tb2.bdstatic.com/tb/img/coming_good_9b62aa6.jpg"}),a.dialog=new $.dialog({holderClassName:"firework-buy-dialog",width:810,height:450,closeable:!1,html:t}),o=$(".firework-buy-dialog"),a.requireInstance("common/widget/ScrollPanel",{container:$(".firework-good-list"),height:310,content:i}),o.find(".firework-good:first").addClass("focus"),o.one("click",".j-close-btn",function(t){t.preventDefault(),o.off(),a.dialog.close()}),o.on("click",".firework-good",function(){o.find(".focus").removeClass("focus"),$(this).addClass("focus")}),o.one("click",".j-preview-btn",function(){e=o.find(".focus").data("index"),a.preview(e)}),o.on("click",".j-buy-btn",function(){e=o.find(".focus").data("index"),a.buyFirework(e)})},buyFirework:function(t){var i=this,e=i.goodData.list[t],o={};o.fire_id=e.id,o.location_id=PageData.thread&&PageData.thread.thread_id||PageData.forum.id,o.location_type="frs"===PageData.page?0:1,o.user_id=PageData.user.id,o.forum_id=PageData.forum.id,o.fire_name=e.fire_name,o.tbs=PageData.tbs,$.get(i.buyFireworkUrl,o,function(t){if(0!==t.no)i.showErrorDialog("error",t.no);else{var e=i.requireInstance("encourage-payment/widget/tdou_view_pay",[function(t){t=t.data,t.data&&t.data.order_info&&2===t.data.order_info.status&&(i.dialog.close(),setTimeout(function(){i.fire("firework.polling")},1e3))},{}]);e.createMain(t.data)}})},preview:function(t){var i=this,e=i.goodData.list[t].fire_animatic;i.dialog.close(),i.flashModule.setUrl(e,i.goodData.list[t].fire_animatic_time),i.showSwfAndStatus(!0)},stopFirework:function(){var t=this;t.countdownModule.hide(),t.noticeModule.hide(),t.listModule.hide(),clearTimeout(t.countdownModule.timer),clearTimeout(t.noticeModule.timer),clearTimeout(t.listModule.timer),t.isStop=!0},countdownFinished:function(t){var i,e=this;if(t=t||0,t>=3&&(null===e.noticeModule.resultData&&(e.noticeModule.resultData=0),null===e.noticeModule.listData&&(e.noticeModule.listData=[])),null!==e.countdownModule.timer||null===e.noticeModule.listData||e.isRegister&&null===e.noticeModule.resultData)t++,setTimeout(function(){e.countdownFinished(t)},1e3);else{for(e.showSwfAndStatus(),i=e.fireworkList.shift();i&&i.fire_end_time<=+new Date/1e3+3;)i=e.fireworkList.shift();e.noticeModule.attended=e.isRegister,i?(e.noticeModule.load(e.presentFirework),e.presentFirework=i,e.countdownModule.render(e.presentFirework)):(e.isActive=!1,e.countdownModule.sleep(e.presentFirework)),e.listModule.render(e.fireworkList),e.isRegister=!1}},showSwfAndStatus:function(t){var i=this,e={},o={};i.flashModule.show(t),t?i.fire("firework.global_preview"):+i.presentFirework.user_id===+i.user.id&&(e.package_id=i.presentFirework.package_id,e.tbs=PageData.tbs,$.get(i.getFireworkCount,e,function(t){o.forum_name=PageData.forum.name,o.location_id=PageData.forum.id,o.location_type="frs"===PageData.page?0:1,o.scores=i.presentFirework.giftpkg_bonus_num,o.user_name=i.user.name,o.portrait=i.user.portrait,o.msg_type=1e4,o.package_id=e.package_id,o.view=t.data.view,o.user_scores=t.data.score,o.rank=t.data.rank,o.member_num=t.data.member_num,o.item="\u70df\u82b1",i.fire("fireworkv2.global_notice",o)}))},preLoadResource:function(){var t;t=new Image,t.src="//web.archive.org/web/20201119054109/https://tb2.bdstatic.com/tb/img/firework_entry_hover_4c63717.png",t=new Image,t.src="//web.archive.org/web/20201119054109/https://tb2.bdstatic.com/tb/img/firework_dialog_back_9682a90.png"},showErrorDialog:function(t,i){var e=this,o='<!-- \u63d0\u793a\u6d6e\u5c42\u6a21\u677f --> <div class="firework-tip">     <p class="result"><%= text %></p>     <p class="firework-attention-tip"><%= tip %></p>     <div class="btn-wrap">         <% if (type == 1) { %>         <a href="#"class="btn-default btn-small button-link j_firework_liken_btn">             <span><em><%= buttonTxt %></em></span>         </a>         <% } %>         <a href="#" class="btn-sub btn-small j_close_btn">             <span><em><%= closeTxt %></em></span>         </a>     </div> </div>',a=baidu.template,s={};"getTdou"===t?(s.text="\u53c2\u4e0e\u6210\u529f\uff0c\u793c\u5305\u5373\u5c06\u964d\u4e34...",s.buttonTxt="\u5173\u6ce8\u672c\u5427",s.closeTxt="\u6211\u77e5\u9053\u4e86",s.tip="\u5173\u6ce8\u672c\u5427\u540e\uff0c\u83b7\u5f97\u793c\u5305\u7684\u6982\u7387\u66f4\u5927\u54e6~",s.type=1):"getTdou_focus"===t?(s.type=t,s.text="\u53c2\u4e0e\u6210\u529f\uff0c\u793c\u5305\u5373\u5c06\u964d\u4e34...",s.closeTxt="\u6211\u77e5\u9053\u4e86",s.tip="\u5df2\u6210\u529f\u5173\u6ce8\u672c\u5427"):""===t?(s.type=t,s.text="\u51c6\u5907\u5c31\u7eea\uff0c\u7b49\u5f85\u793c\u5305\u964d\u4e34...",s.closeTxt="\u6211\u77e5\u9053\u4e86",s.tip="\u5df2\u7ecf\u5173\u6ce8\u672c\u5427"):(s.type="error",s.text=e.errorMap[i]||"\u670d\u52a1\u5668\u6b63\u5fd9...",s.closeTxt="\u5173\u95ed");var n=a(o,s),r=new $.dialog({holderClassName:"firework-tip-dialog",html:n,width:420});r.element.find(".j_close_btn").one("click",function(){return r.close(),!1}),"getTdou"===t&&r.element.find(".j_firework_liken_btn").one("click",function(t){t.preventDefault(),e.likeForum(),r.close()})},likeForum:function(){var t=this,i=PageData.tbs,e=PageData.forum.id,o=$.tb.escapeHTML(PageData.forum.name),a=PageData.user.name+"&ie=utf-8";$.tb.post(t.likeForumUrl,{fid:e,fname:o,tbs:i,uid:a,ie:"gbk"})},getFireworkList:function(t){var i=this;0===t.no?i.noticeModule.listData=t.data||[]:i.jsonpRetryTime>0?(i.jsonpRetryTime--,setTimeout(function(){$.getScript(i.getFireworkListUrl+"="+i.presentFirework.package_id+"&tag="+ +new Date)},500)):i.noticeModule.listData=t.data||[]},getFirework:function(t){var i=this;i.goodData=t,i.rankData&&i.showFireworkDialog()}}});_.Module.define({path:"encourage-appforum/widget/novel_icons",sub:{initial:function(){},getMonthlyTicketIcon:function(){return"<i class='novel-monthly-ticket-icon'></i>"},getNovelLevelIcon:function(n,e,o){e=e||"",o=o||"";var l="";return l=""===o?"<i class='novel-level-icon novel-level-"+n+"' title='"+e+"'></i>":"<a target='_blank' href='"+o+"' class='novel-level-icon novel-level-"+n+"' title='"+e+"'></a>"},getNovelFamousIcon:function(n){return'<span class="novel-famous-icon">'+n+"</span>"},getNovelRankIcon:function(){var n=void 0===arguments[0]?1:arguments[0];return"<i class='novel-rank-icon novel-rank-"+n+"'></i>"},getNovelTopFansIcon:function(n){return"<i class='novel-top-fans-icon novel-top-fans-"+n+"'></i>"}}});!function(e){e.idleTimer=function(t,i){var n,a=function(){var e,t=function(e,t){return""!==e?e+t.slice(0,1).toUpperCase()+t.slice(1):t},i=function(){var i=!1;return"number"==typeof window.screenX&&["webkit","moz","ms","o",""].forEach(function(n){0==i&&void 0!=document[t(n,"hidden")]&&(e=n,i=!0)}),i}(),n=function(){return i?document[t(e,"hidden")]:void 0},a=function(){return i?document[t(e,"visibilityState")]:void 0};return{hidden:n(),visibilityState:a(),visibilitychange:function(t,s){return s=!1,i&&"function"==typeof t?document.addEventListener(e+"visibilitychange",function(e){this.hidden=n(),this.visibilityState=a(),t.call(this,e)}.bind(this),s):void 0}}}(void 0);"object"==typeof t?(n=t,t=null):"number"==typeof t&&(n={timeout:t},t=null),i=i||document,n=e.extend({idle:!1,timeout:3e4,events:"mousemove keydown wheel DOMMouseScroll mousewheel mousedown touchstart touchmove MSPointerDown MSPointerMove"},n);var s=e(i),r=s.data("idleTimerObj")||{},o=function(t){var n=e.data(i,"idleTimerObj")||{};n.idle=!n.idle,n.olddate=+new Date;var a=e.Event((n.idle?"idle":"active")+".idleTimer");e(i).trigger(a,[i,e.extend({},n),t])},l=function(t){var n=e.data(i,"idleTimerObj")||{};if(null==n.remaining){if("mousemove"===t.type){if(t.pageX===n.pageX&&t.pageY===n.pageY)return;if("undefined"==typeof t.pageX&&"undefined"==typeof t.pageY)return;var a=+new Date-n.olddate;if(200>a)return}clearTimeout(n.tId),n.idle&&o(t),n.lastActive=+new Date,n.pageX=t.pageX,n.pageY=t.pageY,n.tId=setTimeout(o,n.timeout)}},u=function(){var t=e.data(i,"idleTimerObj")||{};t.idle=t.idleBackup,t.olddate=+new Date,t.lastActive=t.olddate,t.remaining=null,clearTimeout(t.tId),t.idle||(t.tId=setTimeout(o,t.timeout))},d=function(){var t=e.data(i,"idleTimerObj")||{};null==t.remaining&&(t.remaining=t.timeout-(+new Date-t.olddate),clearTimeout(t.tId))},c=function(){var t=e.data(i,"idleTimerObj")||{};null!=t.remaining&&(t.idle||(t.tId=setTimeout(o,t.remaining)),t.remaining=null)},m=function(){var t=e.data(i,"idleTimerObj")||{};clearTimeout(t.tId),s.removeData("idleTimerObj"),s.off("._idleTimer")},f=function(){var t=e.data(i,"idleTimerObj")||{};if(t.idle)return 0;if(null!=t.remaining)return t.remaining;var n=t.timeout-(+new Date-t.lastActive);return 0>n&&(n=0),n};if(null===t&&"undefined"!=typeof r.idle)return u(),s;if(null===t);else{if(null!==t&&"undefined"==typeof r.idle)return!1;if("destroy"===t)return m(),s;if("pause"===t)return d(),s;if("resume"===t)return c(),s;if("reset"===t)return u(),s;if("getRemainingTime"===t)return f();if("getElapsedTime"===t)return+new Date-r.olddate;if("getLastActiveTime"===t)return r.lastActive;if("isIdle"===t)return r.idle}return"undefined"!=typeof a.hidden?a.visibilitychange(function(){o()}):(s.on(e.trim((n.events+" ").split(" ").join("._idleTimer ")),function(e){l(e)}),r.idle||(r.tId=setTimeout(o,r.timeout))),r=e.extend({},{olddate:+new Date,lastActive:+new Date,idle:n.idle,idleBackup:n.idle,timeout:n.timeout,remaining:null,tId:null,pageX:null,pageY:null}),e.data(i,"idleTimerObj",r),s},e.fn.idleTimer=function(t){return this[0]?e.idleTimer(t,this[0]):this}}(jQuery),_.Module.define({path:"encourage-base/widget/global_notice/barrage",requires:[],sub:{isInit:!1,initial:function(){if(!this.isInit){window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(e){return setTimeout(e,1e3/60)},window.cancelAnimationFrame=window.cancelAnimationFrame||window.clearTimeout,this.isInit=!0;var e=function(){function e(e,t){e&&(h=$.extend(h,t),c=e,p=0==c.width(),c.html(""),m=[],f=[],g=0)}function t(){for(var e=0;e<h.rowCount;e++){var t=new u;f.push(t),c.append(t.$row)}}function i(){f=[],c.html("")}function n(e){m.push(e),d||l()}function a(){_=!0}function s(){_=!1,d||l()}function r(){if(c.width()>=h.containerWidth)p=!1,t();else{var e=c.width(),i=parseFloat(c.css("marginLeft"));e+=h.unfoldSpeed||h.speed,i-=h.unfoldSpeed||h.speed,c.css({width:e,marginLeft:i})}}function o(){p=!0,i(),c.fadeOut("normal",function(){var e=parseFloat(c.css("marginLeft"))+c.width();c.css({display:"block",width:0,marginLeft:e})})}function l(){if(_)return cancelAnimationFrame(d),d=null,void 0;var e=m.length;if(!g&&!e){if(p)return cancelAnimationFrame(d),d=null,void 0;o()}if((g||e)&&p)r();else{if(g<=h.scrollElementMaxLength&&e){var t=m.shift(),i=Math.round(Math.random()*(h.rowCount-1));f[i].add(t),g+=1}$.each(f,function(e,t){t.scroll()})}d=requestAnimationFrame(l)}function u(){this.$row=$("<div></div>"),this.scrollElementArr=[],this.containerWidth=c.width(),this.marginLeft=this.width=this.containerWidth,this.$row.css({"margin-left":this.marginLeft,height:h.rowHeight,width:this.width,position:"relative"})}var d,c,m=[],f=[],g=0,p=!0,_=!1,h={speed:5,rowCount:1,rowHeight:20,scrollElementMaxLength:30,elementMarginLeft:20,containerWidth:988,containerMarginLeft:-498};return u.prototype={add:function(e){var t=this.scrollElementArr[this.scrollElementArr.length-1],i=h.elementMarginLeft,n=this.containerWidth-this.marginLeft+i;if(t){var a=t.position(),s=t.outerWidth(!0),r=this.containerWidth-a.left-s-this.marginLeft;n=r>i?r:i}e.css({display:"inline-block","margin-left":n}),this.$row.append(e),this.width+=e.outerWidth(!0),this.$row.css({width:this.width}),this.scrollElementArr.push(e)},shift:function(){if(this.scrollElementArr.length){var e=this.scrollElementArr.shift(),t=e.outerWidth(!0);e.remove(),e=null,g-=1,this.scrollElementArr.length?(this.width-=t,this.marginLeft+=t):(this.width=this.containerWidth,this.marginLeft=0),this.$row.css({width:this.width,"margin-left":this.marginLeft})}},scroll:function(){this.scrollElementArr.length&&(this.checkElementScrollEdge(),this.marginLeft-=h.speed,this.$row.css({"margin-left":this.marginLeft}))},checkElementScrollEdge:function(){if(this.marginLeft<0){var e=this.scrollElementArr[0],t=e.outerWidth(!0);t+this.marginLeft<=0&&this.shift()}}},{init:e,addMessage:n,pause:a,resume:s}}();$.extend(this,e)}}}}),_.Module.define({path:"encourage-base/widget/global_notice",requires:["encourage-base/widget/global_notice/barrage","encourage-appforum/widget/novel_icons"],sub:{intervalId:null,waitToRollList:[],showedFireworkMap:{},pkgIds:[],viewTotalNum:0,isFireworkV2:0,fireworkList:[],locationType:"frs"===PageData.page?0:1,locationId:PageData.forum.id,messageTplMap:{1e4:['<div class="global_notice_unit">','<a  href="#{href}" target="_blank">','#{user_name}\u6b63\u5728<span class="forum_name">[#{forum_name}\u5427]</span>\u653e#{item}\uff0c','  \u6389\u843d<span class="tdou_num">#{scores}</span><i class="global_message_tdou_icon"></i>','<span class="get_firework_icon"></span></a>',"</div>"].join(""),10001:['<div class="global_notice_unit">','<a  href="#{href}" target="_blank">','#{user_name}\u5728<span class="forum_name">[#{forum_name}\u5427]</span>','\u6361\u5230<span class="tdou_num">#{scores}</span><i class="global_message_tdou_icon"></i>',"</a>","</div>"].join(""),10002:['<div class="global_notice_unit">','<a  href="/f?kw=t%E8%B1%86%E5%A8%B1%E4%B9%90%E5%9F%8E&ie=utf-8" target="_blank">','#{user_name}\u5728<span class="forum_name">[#{game_name}]</span>\u6e38\u620f\u4e2d\u5927\u80dc\uff0c','\u8d62\u53d6\u4e86<span class="tdou_num">#{scores}</span><i class="global_message_tdou_icon"></i>',"</a>","</div>"].join(""),10003:['<div class="global_notice_unit">','<a  href="/f?kw=#{forum_name}&ie=utf-8" target="_blank">','#{user_name}\u5728<span class="forum_name">[#{forum_name}\u5427]</span>','\u53d1\u5e03<span class="tdou_num">#{scores}</span><i class="global_message_tdou_icon"></i>',"\u7684\u3010#{bonus_name}\u3011\u7ea2\u5305#{bonus_num}\u4e2a","</a>","</div>"].join(""),10004:['<div class="global_notice_unit">','<a  href="https://web.archive.org/web/20201119054109/http://spread.xiu8.com/spreed!baiduGo.jspa?pid=1072&sid=104&t=2&roomId=#{live_id}" target="_blank">','<span class="forum_name">#{user_name}</span>\u699c\u4e0a\u6709\u540d\uff0c\u4e00\u63b7\u5343\u91d1\u5e7f\u53d1T\u8c46\u3001\u798f\u888b\uff01','<span class="get_firework_icon"></span></a>',"</a>","</div>"].join(""),10005:['<div class="global_notice_unit">','<a href="/f?kw=#{forum_name}&ie=utf-8" target="_blank">','<span class="forum_name">[#{forum_name}\u5427]</span>','\u53d1\u5e03<span class="tdou_num">#{bonus_num}</span>\u4e2a',"\u73b0\u91d1\u7ea2\u5305","</a>","</div>"].join(""),10006:['<div class="global_notice_unit">','<a href="/f?kw=#{forum_name}&ie=utf-8" target="_blank">','\u4e07\u4eba\u819c\u62dc\uff0c\u606d\u559c <span class="forum_name">#{reader_name}</span> \u6210\u4e3a',' <span class="forum_name">[#{forum_name}]</span> \u5427\u7b2c#{level_count}\u4f4d','<i class="novel-level-icon global-novel-notice novel-level-#{fans_level}"></i>',"</a>","</div>"].join(""),10007:['<div class="global_notice_unit">','<a href="/p/#{thread_id}?from_notice=1" target="_blank">','\u4e07\u4eba\u819c\u62dc\uff0c<span class="forum_name">#{reader_name}</span>\u4e3a<span class="forum_name">[#{forum_name}\u5427]</span>\u6295\u7968#{month_ticket}\u5f20\uff0c','<span class="forum_name">\u8d34\u5427\u798f\u5229\u9001\u9001\u9001\uff01</span><span class="get_firework_icon"></span>',"</a>","</div>"].join(""),10008:['<div class="global_notice_unit">','<a  href="#{href}" target="_blank">','#{user_name}\u6b63\u5728<span class="forum_name">[#{forum_name}\u5427]</span>\u653e#{item}\uff0c','  \u6389\u843d<span class="tdou_num">#{scores}</span><i class="global_message_tdou_icon"></i>','<span class="get_firework_icon"></span></a>',"</div>"].join("")},statusTplMap:['<div id="firework_status" class="firework_status_wrap">','<div class="user_info">','<div class="photo">','<img src="https://web.archive.org/web/20201119054109/https://gss0.bdstatic.com/6LZ1dD3d1sgCo2Kml5_Y_D3/sys/portrait/item/#{portrait}" width="72" height="72" />',"</div>",'<div class="name_and_tdou">','<p class="name">#{user_name}</p>','<p class="tdou">','<i class="icon_tdou"></i>','<span class="j_user_scores">#{user_scores}</span>','<a href="javascript:;" class="j_buy_tdou"> [\u83b7\u53d6]</a>',"</p>","</div>","</div>",'<div class="firework_info">','<p>\u60a8\u4f4d\u4e8e#{item}\u8fbe\u4eba\u699c\u7b2c<span class="orange_text">#{rank}</span>\u4f4d</p>',"</div>",'<div class="firework_operate">','<a href="javascript:;" class="btn_repeat j_btn_repeat"></a>',"</div>",'<a href="javascript:;" class="btn_close j_close"></a>',"</div>"].join(""),statusTplMapV2:['<div id="firework_status" class="firework_status_wrap">','<div class="user_info">','<div class="photo">','<img src="https://web.archive.org/web/20201119054109/https://gss0.bdstatic.com/6LZ1dD3d1sgCo2Kml5_Y_D3/sys/portrait/item/#{portrait}" width="72" height="72" />',"</div>",'<div class="name_and_tdou">','<p class="name">#{user_name}</p>','<p class="tdou">','<i class="icon_tdou"></i>','<span class="j_user_scores">#{user_scores}</span>','<a href="javascript:;" class="j_buy_tdou"> [\u83b7\u53d6]</a>',"</p>","</div>","</div>",'<div class="firework_info">','<p>\u60a8\u4f4d\u4e8e#{item}\u8fbe\u4eba\u699c\u7b2c<span class="orange_text">#{rank}</span>\u4f4d</p>',"</div>",'<div class="firework_operate">','<a href="javascript:;" class="btn_repeat j_btn_repeat"></a>',"</div>",'<a href="javascript:;" class="btn_close j_close"></a>',"</div>"].join(""),initial:function(e){var t=this;e=$.extend({},e);var i=e.fireworkOptionsConf;fireworkOptionsConfArr=i.split("|"),this.fireworkOptions={width:fireworkOptionsConfArr[0],height:fireworkOptionsConfArr[1],item:fireworkOptionsConfArr[2]},this.scores=e.scores,this.level=e.level,this.isFireworkV2=e.isFireworkV2,this.$notice=$("#global_notice_wrap"),this.barrage=this.requireInstance("encourage-base/widget/global_notice/barrage"),this.barrage.init(this.$notice,{speed:2,foldSpeed:15,unfoldSpeed:10,rowCount:1,rowHeight:50,scrollElementMaxLength:100,elementMarginLeft:20,containerWidth:980,containerMarginLeft:-490}),this.startPolling(),window.jsonpGlobalMessageHandler=function(e){return function(t){e.globalMessageHandler(t)}}(this),this.observe("fireworkv2.global_notice",function(e,i){t.showFireworkStatusV2(i)}),this.observe("firework.global_notice",function(e,i){var n=t.buildMessage(i);n&&t.showMessageBar($(n)),t.showFireworkStatus(i)}),this.$notice.on("click",function(){var e=$(this).data("type");$.stats.track("\u5168\u5c40\u516c\u544a\u533a\u57df\u70b9\u51fb\u91cf_"+e,"firework_activity")}),this.observe("firework.global_preview",function(){t.previewFireworkStatus()}),this.observe("firework.global_preview_close",function(){t.previewFireworkStatusClose()}),this.observe("firework.polling",function(){t.pollingAtOnce()})},startPolling:function(){var e=this;$(document).idleTimer(6e4),$(document).on("idle.idleTimer",function(){e.pausePolling()}),$(document).on("active.idleTimer",function(){e.polling()}),e.$notice.on("mouseenter",function(){e.barrage.pause()}).on("mouseleave",function(){e.barrage.resume()}),e.polling()},polling:function(){this.intervalId&&clearInterval(this.intervalId),this.intervalId=setInterval(function(){$.getScript("//web.archive.org/web/20201119054109/https://tbmsg.baidu.com/gmessage/get?mtype=1")},1e4),$.getScript("//web.archive.org/web/20201119054109/https://tbmsg.baidu.com/gmessage/get?mtype=1")},pollingAtOnce:function(){this.intervalId&&clearInterval(this.intervalId),this.intervalId=setInterval(function(){$.getScript("//web.archive.org/web/20201119054109/https://tbmsg.baidu.com/gmessage/get?mtype=1")},1e4),$.getScript("//web.archive.org/web/20201119054109/https://tbmsg.baidu.com/gmessage/get?mtype=1")},pausePolling:function(){this.intervalId&&clearInterval(this.intervalId)},globalMessageHandler:function(e){var t,i,n=$.tb.Storage.get("global_message_cid"),a=0||$.tb.Storage.get("global_message_update_time"),s=0,r=this,o=[],l=0;if(i=r.fireworkList.length,i>0){var u;for(u=[],t=0;i>t;t++)1e3*r.fireworkList[t].msg_body.fire_start_time<=+new Date?r.handleSingleMessage(r.fireworkList[t]):u.push(r.fireworkList[t]);r.fireworkList=u}if($.isArray(e)){for(t=0,i=e.length;i>t;t++)if(10008!==e[t].msg_body.msg_type)e[t].msg_id=+e[t].msg_id,n<e[t].msg_id&&(s=s>e[t].msg_id?s:e[t].msg_id,r.handleSingleMessage(e[t]));else{if(!r.isFireworkV2)continue;e[t].msg_body.fire_update_time>a&&(1!==e[t].not_set_fire&&e[t].msg_body.location_id===r.locationId&&e[t].msg_body.location_type===r.locationType&&o.push(e[t]),1e3*e[t].msg_body.fire_start_time>+new Date?r.fireworkList.push(e[t]):r.handleSingleMessage(e[t]),l=a>e[t].msg_body.fire_update_time?a:e[t].msg_body.fire_update_time)}s>n&&$.tb.Storage.set("global_message_cid",s,+new Date+31536e6)}0!==o.length&&r.fire("firework.add_firework",JSON.stringify(o)),l&&$.tb.Storage.set("global_message_update_time",l,+new Date+6e5)},handleSingleMessage:function(e){var t,i=+new Date,n=e.end_time||e.msg_body.fire_end_time;1e3*n>i&&(t=this.buildMessage(e.msg_body),t&&this.showMessageBar(t))},buildMessage:function(e){function t(e){var t="";return t="undefined"==typeof e.location_type?"javascript:void(0);":0==e.location_type?"/f?kw="+encodeURIComponent(e.forum_name):"/p/"+e.location_id}function i(e){if(e>9999){var t=e%1e4!==0?(e/1e4).toFixed(1):e/1e4;return t+"\u4e07"}return e}var n=+new Date,a=this.messageTplMap[e.msg_type];if(e.scores=i(e.scores),a){if(e.end_time&&1e3*e.end_time<n)return;if(1e4==e.msg_type){if(self.showedFireworkMap[e.package_id])return;self.showedFireworkMap[e.package_id]=1,this.fire("play.firework",e)}else if(10001==e.msg_type)this.fire("get.firework",e);else if(10002==e.msg_type&&1!=PageUnit.load("global_notice_game_switch"))return;return this.$notice.data("type",e.msg_type),$($.tb.format(a,$.extend(e,{href:t(e)},this.fireworkOptions)))}},showMessageBar:function(e){this.barrage.addMessage(e)},previewFireworkStatus:function(){var e=$("#firework_status"),t=this;if(0==e.length){var i=$.tb.format(this.statusTplMap,$.extend({portrait:PageData.user.portrait,user_name:PageData.user.name,user_scores:t.scores.scores_total||0,rank:1,item:"\u70df\u82b1"},this.fireworkOptions));e=$(i).insertAfter(this.$notice)}e.find(".j_view_num").text(9321332),e.find(".j_user_num").text(2321301),e.animate({bottom:0});var n={forum_name:PageData.forum.name,location_id:this.locationId,location_type:this.locationType,scores:"5\u4e07",user_name:PageData.user.name,portrait:PageData.user.portrait,msg_type:1e4,item:"\u70df\u82b1"},a=this.messageTplMap[n.msg_type];this.showMessageBar($($.tb.format(a,$.extend(n,this.fireworkOptions))))},previewFireworkStatusClose:function(){var e=$("#firework_status");e.length>0&&e.remove()},showFireworkStatus:function(e){this.pkgIds.push(e.package_id);var t=this,i=$("#firework_status");if(0==i.length){var n=$.tb.format(this.statusTplMap,$.extend(e,this.fireworkOptions));i=$(n).insertAfter(this.$notice),i.find(".j_close").on("click",function(){i.animate({height:0},300,function(){i.remove(),t.pkgIds.length=0})}),i.find(".j_btn_repeat").on("click",function(){t.fire("buy.firework")}),i.find(".j_buy_tdou").on("click",function(){t.requireInstance("encourage-payment/widget/tcharge_dialog")})}else i.find(".j_user_scores").text(e.user_scores);i.animate({bottom:0}),this.increaseViewNum(i.find(".j_view_num"),this.viewTotalNum,this.viewTotalNum+=e.view),this.pollingVisitNum(i.find(".j_user_num"),this.pkgIds.length)},showFireworkStatusV2:function(e){var t=this,i=$("#firework_status");if(0==i.length){var n=$.tb.format(this.statusTplMapV2,$.extend(e,this.fireworkOptions));i=$(n).insertAfter(this.$notice),i.find(".j_close").on("click",function(){i.animate({height:0},300,function(){i.remove(),t.pkgIds.length=0})}),i.find(".j_btn_repeat").on("click",function(){t.fire("buy.firework")}),i.find(".j_buy_tdou").on("click",function(){t.requireInstance("encourage-payment/widget/tcharge_dialog")})}else i.find(".j_user_scores").text(e.user_scores);i.animate({bottom:0})},pollingVisitNum:function(e,t){var i=this,n=0,a=function(){n>30||i.pkgIds.length>t||setTimeout(function(){$.post("/tbmall/submit/giftpkg/getView",{pids:i.pkgIds.toString()},function(t){0==t.no&&e.text(t.data.uv)}),n++,a()},1e3)};a()},increaseViewNum:function(e,t,i){var n=this,a=function(t,a){var s=n.easeOutQuint(t,a,i,3e4);e.text(parseInt(s,10))},s=0,r=function(){s>30||n.viewTotalNum>i||setTimeout(function(){s++,a(1e3*s,t),r()},1e3)};r()},easeOutQuint:function(e,t,i,n){return e/=n,e--,i*(e*e*e*e*e+1)+t}}});

}
/*
     FILE ARCHIVED ON 05:41:09 Nov 19, 2020 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 08:30:53 Feb 18, 2021.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
*/
/*
playback timings (ms):
  exclusion.robots: 0.396
  esindex: 0.015
  load_resource: 1685.823 (2)
  captures_list: 455.045
  PetaboxLoader3.resolve: 1284.538 (3)
  exclusion.robots.policy: 0.38
  PetaboxLoader3.datanode: 299.956 (5)
  RedisCDXSource: 2.39
  LoadShardBlock: 357.336 (3)
  CDXLines.iter: 87.313 (3)
*/